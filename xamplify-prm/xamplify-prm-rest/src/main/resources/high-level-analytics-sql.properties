
#Active Partnership-(Partners who redistribute atleast one campaign and with a company profile)-Company wise-All Roles-count
#Active Partnership (Partner who Redistributed atleast one Campaign and with Company Profile)
#For All Roles- Except Marketing , Marketing & Partner---Own Vanity Login
#Marketing Role:Doesn't have Partners.
#---------------------------------------------------------------------------------------

highlevelanalytics.activePartnersCount=select cast(count(a) as int) as \"Active Partners\" from \
(select distinct u.company_id \
from xt_user_profile u \
inner join xt_partnership pc on(pc.partner_id = u.user_id) \
left join xt_company_profile xcp on u.company_id=xcp.company_id \
left join xt_campaign c on c.customer_id=u.user_id \
where pc.vendor_company_id =${getCompanyIdByUserIdQuery} \
and c.is_nurture_campaign = true \
and c.is_launched = true \
and c.vendor_organization_id =${getCompanyIdByUserIdQuery} \
and pc.status = 'approved' \
or u.user_id  in(select distinct partner_id from xt_partnership where partner_id in( \
select distinct org_admin_id from xt_team_member where team_member_id in (select distinct customer_id \
from xt_campaign where is_nurture_campaign = true \
and is_launched = true and vendor_organization_id =${getCompanyIdByUserIdQuery}))and vendor_company_id=${getCompanyIdByUserIdQuery}) \
)a


#8.Active Partnership-(Partners who redistribute atleast one campaign and with a company profile)-Company wise-Team Member-count

highlevelanalytics.activePartnersTeamMemberCountQuery=select cast(count(a) as int ) as \"Active Partners\" from \
(select distinct xup1.company_id \
from public.xt_campaign xc \
left join xt_user_profile xup on (xc.customer_id = xup.user_id) \
left join xt_company_profile xcp on (xup.company_id = xcp.company_id) \
left join xt_campaign xc1 on (xc.campaign_id = xc1.parent_campaign_id) \
left join xt_user_profile xup1 on (xc1.customer_id = xup1.user_id) \
left join xt_company_profile xcp1 on (xup1.company_id = xcp1.company_id) \
  where xc1.is_launched= true and xc1.is_nurture_campaign = true \
and xc1.vendor_organization_id=${getCompanyIdByUserIdQuery} \
and xup1.company_id in (select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
	left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
	and p.partner_id is not null and p.status = 'approved')and  xup.company_id=${getCompanyIdByUserIdQuery})a 


#Inactive Partners (Partner who does not redistributed Campaign and without CompanyProfile )
#For All Roles- Except Marketing , Marketing & Partner---Own Vanity Login

#Marketing Role:Doesn't have Partners.
#-----------------------------------------------------------------------------------------------------


highlevelanalytics.inActivePartnersCount= select cast(count(a) as int) as \"inactive partners\" from \
 (select distinct u.user_id \
   from xt_user_profile u \
    left join xt_partnership pc on (pc.partner_id = u.user_id) \
    left outer join xt_company_profile p on(u.company_id= p.company_id) \
    where pc.vendor_company_id = ${getCompanyIdByUserIdQuery} \
     and pc.status = 'approved' \
     and u.user_id not in  \
    (select distinct customer_id from xt_campaign where is_nurture_campaign = true \
    and is_launched = true and vendor_organization_id = ${getCompanyIdByUserIdQuery})  \
    and u.user_id not in(select distinct partner_id from xt_partnership where partner_id in( \
    select distinct org_admin_id from xt_team_member where team_member_id in (select distinct customer_id  \
    from xt_campaign where is_nurture_campaign = true  \
    and is_launched = true and vendor_organization_id=${getCompanyIdByUserIdQuery}))and vendor_company_id= ${getCompanyIdByUserIdQuery}) \
)a


#9.Inactive Partners: (Partners who doesn\u2019t redistribute campaigns and without company profile)-company wise-Team Member-count

highlevelanalytics.inActivePartnersTeamMemberCountQuery=select cast(count(a) as int ) as \"inactive partners teammember\" from \
(select distinct u.user_id \
 from xt_user_profile u inner join xt_partnership pc on(pc.partner_id = u.user_id) \
 left outer join xt_company_profile p on(u.company_id= p.company_id) \
left outer join xt_user_userlist uul on(u.user_id = uul.user_id) \
left outer join  xt_user_list ul on (ul.user_list_id = uul.user_list_id) \
 where pc.status = 'approved' and u.user_id not in  \
(select customer_id from xt_campaign where is_nurture_campaign = true  \
 and is_launched = true and vendor_organization_id =${getCompanyIdByUserIdQuery})  \
 and u.user_id not in(select distinct partner_id from xt_partnership where partner_id in(  \
    select distinct org_admin_id from xt_team_member where team_member_id in (select distinct customer_id  \
    from xt_campaign where is_nurture_campaign = true  \
    and is_launched = true and vendor_organization_id=${getCompanyIdByUserIdQuery}))and vendor_company_id= ${getCompanyIdByUserIdQuery}) \
 and uul.user_id in (select distinct p.partner_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
	left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
	and p.partner_id is not null and p.status = 'approved') and pc.vendor_company_id=${getCompanyIdByUserIdQuery})a 



#------------Total campaigns Launched------All Roles----Own Vanity Login---------

#except PRM,PRM & PARTNER 
#Condition: Both To campaigns +  through campaigns

highlevelanalytics.totalCampaignLaunched=select cast(count(a) as int)  as \"Campaigns Launched\" from \
(select distinct c.campaign_id \
from \
xt_campaign c \
left join xt_user_profile up on (up.user_id=c.customer_id) \
where up.company_id=${getCompanyIdByUserIdQuery} \
and c.is_launched= true \
and c.is_nurture_campaign = false \
And c.campaign_id is not null)a


highlevelanalytics.totalCampaignLaunchedForMarketingRole=select cast(count(a) as int)  as \"Campaigns Launched\" from \
(select distinct c.campaign_id \
from \
xt_campaign c \
left join xt_user_profile up on (up.user_id=c.customer_id) \
where up.company_id=${getCompanyIdByUserIdQuery} \
and c.is_launched= true \
and c.is_channel_campaign = false \
and c.is_nurture_campaign = false \
And c.campaign_id is not null)a
#5.Total Campaigns Launched(Through Campaigns)- company wise-All Roles(Except Partner Role)-count\u2014-For Bar chart\u2014

highlevelanalytics.totalThroughCampaignLaunchedQuery=select cast(count(c.campaign_id) as int)  as \"Through Campaigns Launched\" from \
xt_campaign c \
left join xt_user_profile up on (up.user_id=c.customer_id) \
where up.company_id=${getCompanyIdByUserIdQuery} \
and c.is_launched= true \
and c.is_channel_campaign = true \
and c.campaign_id is not null \

#5.Total Campaigns Launched(To Campaigns)- company wise-All Roles(Except Partner Role)-count--

highlevelanalytics.totalToCampaignLaunchedQuery=select cast(count(c.campaign_id) as int)  as \"To Campaigns Launched\" from \
xt_campaign c \
left join xt_user_profile up on (up.user_id=c.customer_id) \
where up.company_id=${getCompanyIdByUserIdQuery} \
and c.is_launched= true  \
and c.is_channel_campaign = false \
and c.is_nurture_campaign = false \
and c.campaign_id is not null \




#Total Campaigns Redistributed by all partner companies(how many times it got redistributed that count we are showing)--company-wise -All Roles-count
#-----Total Campaigns Redistributed by All Partner Companies----All Roles----own vanity login\u2014---------

#Except :PRM,PRM & PARTNER Doesn't have campaigns
#Except: Marketing, Marketing &partner Doesn't have partners
#Note: Showing number of times campaign got redistributed count.
#---------------------------------------------------------------------------------------



highlevelanalytics.totalRedistributedCampaigns=select cast(count(a) as int) as \"Redistributed Campaigns\" from \
(select distinct p.campaign_id as red_campaigns \
from \
xt_campaign c \
left join xt_campaign p on (c.campaign_id=p.parent_campaign_id) \
left join xt_user_profile up on (up.user_id=c.customer_id) \
left join xt_company_profile cp on (up.company_id=cp.company_id) \
left join xt_user_profile up1 on (up1.user_id=p.customer_id) \
left join xt_partnership ps on up1.company_id=ps.partner_company_id \
left join xt_company_profile cp1 on (up1.company_id=cp1.company_id) \
where up.company_id=${getCompanyIdByUserIdQuery} \
and p.vendor_organization_id=${getCompanyIdByUserIdQuery} \
and p.is_launched =true \
and p.is_nurture_campaign=true \
And p.campaign_id is not null  \
and ps.status = 'approved' \
)a




#6.Total Campaigns Redistributed by all partner companies(how many times it got redistributed that count we are showing)--company-wise\u2014----Team Member\u2014-count

highlevelanalytics.totalRedistributedCampaignsForTeamMemberQuery=select cast(count(distinct p.campaign_id) as int)  as \"red_campaigns\" \
from \
xt_campaign c \
left join xt_campaign p on (c.campaign_id=p.parent_campaign_id) \
left join xt_user_profile up on (up.user_id=c.customer_id) \
left join xt_company_profile cp on (up.company_id=cp.company_id) \
left join xt_user_profile up1 on (up1.user_id=p.customer_id) \
left join xt_company_profile cp1 on (up1.company_id=cp1.company_id) \
where up1.company_id in (select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId \
	and p.partner_id is not null and p.status = 'approved') \
and up.company_id= ${getCompanyIdByUserIdQuery} \
and p.vendor_organization_id=${getCompanyIdByUserIdQuery} \
and p.is_launched =true \
and p.is_nurture_campaign=true \
And p.campaign_id is not null \



#-------------- Total Users -------which includes all the users of Platform -------For All Roles-----
#For All Roles- Own Vanity Login

highlevelanalytics.totalUsersQuery=select cast(count(a) as int) as \"Total Users\" from \
(select distinct user_id \
from xt_user_profile \
where company_id=${getCompanyIdByUserIdQuery} \
and user_id is not null)a \


#Partnership with Company profile(partners with a company profile)- company wise-All Roles-count
#Partnership with company profile ( with CompanyProfile)-----
#For All Roles- Except Marketing , Marketing & Partner---Own Vanity Login
#Marketing Role:Doesn\u2019t have Partners
#--------------------------------------------------------------------------------------


highlevelanalytics.onBoardPartnersQuery=select cast(count(a) as int) as \"Partners with company profile\" from \
(select distinct partner_id as "Partners with company profile" \
from xt_partnership \
where vendor_company_id=${getCompanyIdByUserIdQuery} \
and partner_company_id is not null \
and status = 'approved')a

#7.Partnership with Company profile(partners with a company profile)- company wise\u2014----------Team Member\u2014--count

highlevelanalytics.onBoardPartnersTeamMemberQuery=select cast(count(distinct partner_id) as int) as \" Partnership with company_profile\" \
from xt_partnership \
where partner_company_id in (select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId \
	and p.partner_id is not null and p.status = 'approved') \
and vendor_company_id= ${getCompanyIdByUserIdQuery} \
and partner_company_id is not null



highlevelanalytics.totalPartnersQuery=select cast(count(distinct a.user_id) as int) as \"team member\" from \
(select distinct t.team_member_id as "user_id" from xt_partnership p, \
 xt_team_member t where p.partner_id=t.org_admin_id and p.vendor_company_id=${getCompanyIdByUserIdQuery} \
 and p.status='approved' and t.team_member_id is not null \
union \
select distinct p.partner_id as "user_id" from xt_partnership p where p.vendor_company_id=${getCompanyIdByUserIdQuery} and p.status='approved' and p.partner_id is not null)a \



#2.Total Onboarded Partner Companies(which includes Partners and Team members)-Company wise--count For Team Member Role:

highlevelanalytics.totalPartnersTeamMemberQuery=select cast(count(a ) as int) as \"total partners\"  from \
(select distinct p.partner_id \
from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
	left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
	and p.partner_id is not null \
	and p.status = 'approved' \
	union \
select distinct xtm.team_member_id as "team members" \
from \
xt_partnership p \
left join xt_team_member xtm on (p.partner_id=xtm.org_admin_id) \
where p.partner_id in  (select distinct p.partner_id \
from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
	left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
	and p.partner_id is not null and p.status = 'approved') and p.vendor_company_id=${getCompanyIdByUserIdQuery} and xtm.team_member_id is not null) a



#----Total Contacts----company wise----OrgAdmin Role ,OrgAdmin&partner Role----

highlevelanalytics.totalcontactsForOrgAdminOrOrgAdminAndPartnerQuery=select cast(count(a) as int) as \"Contacts\" from \
(select distinct uul.user_id \
from \
xt_user_list ul \
left join xt_user_userlist uul on (uul.user_list_id= ul.user_list_id ) \
left join xt_user_profile xup on (xup.user_id=uul.user_id) \
where ul.is_partner_userlist=false \
and uul.user_id is not null \
and ul.module_name='CONTACTS' \
And ul.email_validation_ind=true \
and ul.company_id in (select distinct partner_company_id from xt_partnership where vendor_company_id=${getCompanyIdByUserIdQuery}) \
union \
select distinct uul.user_id \
from \
xt_user_list ul \
left join xt_user_userlist uul on (uul.user_list_id= ul.user_list_id ) \
left join xt_user_profile xup on (xup.user_id=uul.user_id) \
where ul.is_partner_userlist=false \
and uul.user_id is not null \
and ul.module_name='CONTACTS' \
And ul.email_validation_ind=true \
and ul.company_id=${getCompanyIdByUserIdQuery})a


#----Total Contacts ----company wise----Marketing Role ,Marketing&Partner Role----

highlevelanalytics.totalcontactsForMarketingOrMarketingAndPartnerQuery=select cast(count(a) as int) as \"Contacts\" from \
(select distinct uul.user_id \
from \
xt_user_list ul \
left join xt_user_userlist uul on (uul.user_list_id= ul.user_list_id ) \
left join xt_user_profile xup on (xup.user_id=uul.user_id) \
where ul.is_partner_userlist=false \
and uul.user_id is not null \
and ul.module_name = 'CONTACTS' \
and ul.email_validation_ind=true \
and ul.company_id=${getCompanyIdByUserIdQuery})a


#-Total Contacts(Contacts+Form contacts) ----company wise----Vendor Role & Vendor&Partner Role---------


highlevelanalytics.totalcontactsForVendorOrVendorAndPartnerQuery =select cast(count(a) as int) as \"Contacts\" from \
(select distinct uul.user_id \
from \
xt_user_list ul \
left join xt_user_userlist uul on (uul.user_list_id= ul.user_list_id ) \
left join xt_user_profile xup on (xup.user_id=uul.user_id) \
where ul.is_partner_userlist=false \
and uul.user_id is not null \
and ul.email_validation_ind=true \
and ul.module_name='CONTACTS' \
and ul.company_id in (select distinct partner_company_id from xt_partnership where vendor_company_id=${getCompanyIdByUserIdQuery} and status = 'approved') \
and uul.user_id is not null)a

#-Total Contacts(Contacts+Form contacts) \u2014----company wise\u2014----Vendor Role & Vendor&Partner Role---------Team Member \u2014-count\u2013valid for all roles

highlevelanalytics.totalcontactsForTeamMemberQuery=select cast(count(distinct xuu1.user_id) as int) as \"Contacts\"  \
from xt_user_list xul \
left join xt_user_userlist xuu on xuu.user_list_id = xul.user_list_id \
left join xt_user_profile xup on xup.user_id = xuu.user_id \
 left join xt_company_profile xcp on xcp.company_id = xul.company_id \
left join xt_user_list xul1 on xul1.company_id = xup.company_id \
left join xt_user_userlist xuu1 on xuu1.user_list_id = xul1.user_list_id \
where xul.is_default_partnerlist = true \
and xul1.is_default_partnerlist = false \
and xul1.module_name ='CONTACTS' \
 and xul1.company_id in (select distinct p.partner_company_id \
from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
	left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
	and p.partner_company_id is not null) and xul.company_id=${getCompanyIdByUserIdQuery}


#Note: PRM , PRM &Partner doesnt have contacts & Campaigns

#4.Total Share Leads company wise- All Roles-count
#---Total Share Leads Count\u2014----------------------------
#For All Roles


highlevelanalytics.shareLeadsQuery=select cast(count(a) as int) as \"Share Leads\" from \
(select distinct up.user_id \
from xt_user_list ul left join xt_user_userlist uul on \
ul.user_list_id =uul.user_list_id \
left join xt_user_profile up on uul.user_id=up.user_id \
where ul.is_partner_userlist= false \
and ul.module_name = 'SHARE LEADS' \
and ul.assigned_company_id= ${getCompanyIdByUserIdQuery} \
and ul.email_validation_ind = true \
and up. email_validation_ind=true)a

#4.Total Share Leads company wise- Team Member Role-count

highlevelanalytics.shareLeadsForTeamMemberQuery=select cast(count(distinct up.user_id) as int) as \"Share Leads\" \
from xt_user_list ul left join xt_user_userlist uul on \
ul.user_list_id =uul.user_list_id \
left join xt_user_profile up on uul.user_id=up.user_id \
where ul.company_id in (select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId \
	and p.partner_id is not null) \
and ul.is_partner_userlist= false \
and ul.module_name = 'SHARE LEADS' \
and ul.assigned_company_id= ${getCompanyIdByUserIdQuery} \
and ul.email_validation_ind = true

#------------Total Users Detail Report----------------------For All Roles-------------------------------------

#For All Roles- Own Vanity Login


highlevelanalytics.totalUsersDetailReport=select distinct email_id as \"emailId\", firstname as \"firstName\", lastname as \"lastName\" , datereg as \"dateReg\", datelastlogin as \"dateLastLogin\" \
from xt_user_profile \
where company_id=${getCompanyIdByUserIdQuery} \
and user_id is not null \

#--------Total Onboarded Partner Companies Detail Report--------Partners which includes (#Partners - 1044 and #Team Members- 379)

#For All Roles- Except Marketing , Marketing & Partner---Own Vanity Login

#Marketing Role:Doesn\u2019t have Partners.
#\u2014------------------------------------------------------------------------------------------------------------

highlevelanalytics.partnerWhichIncludesPartnerAndTeamMember=select a.partner_company_name as \"partnerCompanyName\",email_id as \"emailId\" ,firstname as \"firstName\" ,lastname as \"lastName\",a.description as \"description\" from \
(select  distinct xcp.company_name as partner_company_name, xup1.email_id email_id, xup1.firstname firstname,xup1.lastname lastname, 'Partner' as Description \
from \
xt_user_profile xup \
left join xt_user_list xul on (xup.user_id=xul.customer_id) \
left join xt_user_userlist xuul on (xul.user_list_id=xuul.user_list_id) \
left join xt_user_profile xup1 on (xup1.user_id=xuul.user_id) \
left join xt_company_profile xcp on xcp.company_id=xup1.company_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and xul.is_partner_userlist= true \
and xup1.user_id is not null \
union \
select  distinct  xcp.company_name as partner_company_name, xup2.email_id email_id, xup2.firstname firstname ,xup2.lastname  lastname,'Team Member' as Description \
from xt_team_member xtm \
join xt_company_profile xcp on xcp.company_id = xtm.company_id \
join xt_user_profile xup2 on xup2.user_id = xtm.team_member_id \
where xtm.org_admin_id in (select distinct partner_id from xt_partnership where vendor_company_id = ${getCompanyIdByUserIdQuery} and xup2.user_id is not null)\
order by 1,5 asc)a  \

#Total Onboarded Partner Companies(which includes Partners and Team members)-Company wise--count For Team Member Role: Detail Report


highlevelanalytics.partnerWhichIncludesPartnerAndTeamMemberForTeamMemberRole=select a.company_name as \"partnerCompanyName\",a.email_id as \"emailId\",a.firstname as \"firstName\" ,a.lastname as \"lastName\",a.description  as \"description\" from \
(select distinct p.partner_id "partner", xcp.company_name, \
xup.email_id , xup.firstname , xup.lastname, \
'Partner' as  "description"  \
from  xt_team_member t  \
left join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id  \
left join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id  \
left join xt_partnership p on ptgm.partnership_id=p.id   \
left join xt_user_profile xup on xup.user_id=p.partner_id   \
left join xt_company_profile xcp on xcp.company_id=xup.company_id  \
left join xt_campaign xc on xc.customer_id=tgum.team_member_id  \
where t.team_member_id = :userId \
and p.partner_id is not null \
and p.status='approved' \
union \
select distinct xtm.team_member_id as "partner", \
xcp.company_name ,xup.email_id, \
xup.firstname,xup.lastname, 'Team Member' as "description" \
from  \
xt_partnership p   \
left join xt_team_member xtm on (p.partner_id=xtm.org_admin_id)  \
left join xt_user_profile xup on xup.user_id=xtm.team_member_id  \
left join xt_company_profile xcp on xcp.company_id=xtm.company_id  \
where p.partner_id in  (select distinct p.partner_id  \
from  xt_team_member t \
left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id  \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
left outer join xt_partnership p on ptgm.partnership_id=p.id  \
left join xt_campaign xc on xc.customer_id=tgum.team_member_id  \
where t.team_member_id = :userId \
and p.partner_id is not null \
and p.status = 'approved')  \
and p.vendor_company_id= ${getCompanyIdByUserIdQuery} \
and xtm.team_member_id is not null) a  \

#Total Campaigns Launched(Through  Campaigns)- company wise-All Roles(Except Partner Role)-Detail Report\u2013for bar chart\u2014

highlevelanalytics.throughCampaignDetailreport=select distinct  c.campaign_name as \"campaignName\", c.campaign_type as \"campaignType\",c.campaign_schedule_type as \"campaignScheduleType\",c.launch_time as \"launchedTime\", count(distinct p.campaign_id) as \"count\" \
from \
xt_campaign c \
left join xt_campaign p on (c.campaign_id=p.parent_campaign_id) \
left join xt_user_profile up on (up.user_id=c.customer_id) \
where up.company_id=${getCompanyIdByUserIdQuery} \
and c.is_launched = true \
and c.is_channel_campaign = true \
and c.campaign_id is not null \
group by 1,2,3,4 \
order by 5 desc \

#Inactive Partners: (Partners who doesn\u2019t redistribute campaigns and without company profile)-company wise-All Roles-detail report

#Inactive Partners -Detail Report (Partner who does not redistributed Campaign and without CompanyProfile )-detail report
#For All Roles- Except Marketing , Marketing & Partner---Own Vanity Login

#Marketing Role:Doesn\u2019t have Partners.
#\u2014----------------------------------------------------------------------------------------------------


highlevelanalytics.inactivePartners=select distinct on ( u.user_id )u.user_id as \"userId\", u.email_id as \"emailId\", max(uul.firstname) as \"firstName\",  mAX(uul.lastname) as \"lastName\", p.company_name as \"companyName\" \
 from xt_user_profile u inner join xt_partnership pc on(pc.partner_id = u.user_id) \
left outer join xt_company_profile p on(u.company_id= p.company_id) \
left outer join xt_user_userlist uul on(u.user_id = uul.user_id) \
left outer join  xt_user_list ul on (ul.user_list_id = uul.user_list_id) \
 where pc.vendor_company_id = ${getCompanyIdByUserIdQuery}  and pc.status = 'approved'  and u.user_id not in  \
(select customer_id from xt_campaign where is_nurture_campaign = true  \
 and is_launched = true and vendor_organization_id =${getCompanyIdByUserIdQuery})  \
and u.user_id not in(select distinct partner_id from xt_partnership where partner_id in(  \
select distinct org_admin_id from xt_team_member where team_member_id in \
(select distinct customer_id   from xt_campaign where is_nurture_campaign = true  \
and is_launched = true and vendor_organization_id =${getCompanyIdByUserIdQuery}))and vendor_company_id=${getCompanyIdByUserIdQuery}) \
group by 1,2,5

#Partnership with Company profile(partners with a company profile)- company wise-All Roles-
#Detail report
#\u2014Partnership with company profile  detail report( with CompanyProfile)



#For All Roles- Except Marketing , Marketing & Partner---Own Vanity Login

#Marketing Role:Doesn\u2019t have Partners.
#\u2014---------------------------------------------------------------------------------------------


highlevelanalytics.onboardPartners=select cp.company_name as \"companyName\", up.email_id as \"email\", up.firstname as \"firstname\",up.lastname as \"lastname\" \
from xt_partnership p \
left join xt_user_profile up on p.partner_id=up.user_id \
left join xt_company_profile cp on up.company_id=cp.company_id \
where p.vendor_company_id=${getCompanyIdByUserIdQuery}\
and p.partner_company_id is not null \
and p.status = 'approved' \

#Active Partnership-(Partners who redistribute atleast one campaign and with a company profile)-Company wise-All Roles-detail report

#Active Partnership- Detail Report (Partner who Redistributed atleast one Campaign and with Company Profile)

highlevelanalytics.activePartners=with pc1 as( \
select  v_com,customer_id,company_id,p_com,user_id,email_id,firstname,lastname,datereg,datelastlogin \
,campaign_name as first_campaign_name,launch_time as first_campaign_launch_time,OrgAdmin,is_launched from ( \
select distinct xcp.company_name as v_com ,xc1.customer_id,xup1.user_id,xup1.email_id,xup1.firstname,xup1.lastname,xup1.datereg,xup1.datelastlogin \
,xup1.company_id,xcp1.company_name as p_com,xc1.campaign_name,xc1.launch_time,OrgAdmin.email_id as OrgAdmin,xc1.is_launched \
,row_number()over(partition by xup1.company_id order by xc1.launch_time) rn \
from public.xt_campaign xc \
left join xt_user_profile xup on (xc.customer_id = xup.user_id) \
left join xt_company_profile xcp on (xup.company_id = xcp.company_id) \
left join xt_campaign xc1 on (xc.campaign_id = xc1.parent_campaign_id) \
left join xt_user_profile xup1 on (xc1.customer_id = xup1.user_id) \
left join xt_company_profile xcp1 on (xup1.company_id = xcp1.company_id) \
left join (select * from public.xt_user_profile where user_id in \
       (select user_id from public.xt_user_role where role_id=12  )) OrgAdmin on(OrgAdmin.company_id=xcp1.company_id) \
  where xc1.is_launched='true' \
and xc1.vendor_organization_id=${getCompanyIdByUserIdQuery} \
and xup.company_id=${getCompanyIdByUserIdQuery} and xup1.company_id in (select \
partner_company_id from xt_partnership where vendor_company_id=${getCompanyIdByUserIdQuery} and status ='approved') \
) fc where rn = 1), \
pc3 as ( \
select v_com,customer_id,company_id,p_com,user_id,email_id,firstname,lastname,datereg,datelastlogin \
,campaign_name as recent_campaign_name,launch_time as recent_campaign_launch_time from ( \
select distinct xcp.company_name as v_com ,xc1.customer_id,xup1.user_id,xup1.email_id,xup1.firstname,xup1.lastname,xup1.datereg,xup1.datelastlogin \
,xup1.company_id,xcp1.company_name as p_com,xc1.campaign_name,xc1.launch_time \
,row_number()over(partition by xup1.company_id order by xc1.launch_time desc) rn \
from public.xt_campaign xc \
left join xt_user_profile xup on (xc.customer_id = xup.user_id) \
left join xt_company_profile xcp on (xup.company_id = xcp.company_id) \
left join xt_campaign xc1 on (xc.campaign_id = xc1.parent_campaign_id) \
left join xt_user_profile xup1 on (xc1.customer_id = xup1.user_id) \
left join xt_company_profile xcp1 on (xup1.company_id = xcp1.company_id) \
  where xc1.is_launched='true' \
 and xc1.vendor_organization_id=${getCompanyIdByUserIdQuery} \
and xup.company_id=${getCompanyIdByUserIdQuery} and xup1.company_id in (select \
partner_company_id from xt_partnership where vendor_company_id=${getCompanyIdByUserIdQuery} and status = 'approved')) rc where rn = 1 \
order by p_com), \
c as \
(select count(distinct c.campaign_id) as red_campaigns, up1.company_id \
from \
xt_campaign p \
left join xt_campaign c on (p.campaign_id=c.parent_campaign_id) \
left join xt_user_profile up on (up.user_id=p.customer_id) \
left join xt_company_profile cp on (up.company_id=cp.company_id) \
left join xt_user_profile up1 on (up1.user_id=c.customer_id) \
left join xt_company_profile cp1 on (up1.company_id=cp1.company_id) \
where up.company_id=${getCompanyIdByUserIdQuery} \
and c.is_launched =true \
and c.vendor_organization_id=${getCompanyIdByUserIdQuery} \
 and c.is_nurture_campaign = true and up1.company_id in (select \
partner_company_id from xt_partnership where vendor_company_id=${getCompanyIdByUserIdQuery} and status = 'approved') \
group by 2) \
select distinct pc1.v_com as \"vendorCompanyName\",pc1.p_com as \"partnerCompanyName\",pc1.user_id as \"userId\", \
pc1.email_id as \"emailId\" \
,pc1.firstname as \"firstName\",pc1.lastname as \"lastName\" \
,pc1.first_campaign_name as \"firstCampaignName\",pc1.first_campaign_launch_time as \"firstCampaignlaunchedTime\" \
,pc3.recent_campaign_name as \"recentCampaignName\",pc3.recent_campaign_launch_time as \"recentCampaignLaunchedTime\", \
c.red_campaigns as \"redistributedCampaignId\" \
from pc1 \
left join pc3 on (pc3.company_id=pc1.company_id) \
left join c on pc3.company_id=c.company_id \




#\u2014-----Total Campaigns Redistributed by All Partner Companies Detail report---All Roles----own vanity login\u2014---------

#Except :PRM,PRM & PARTNER\u2013Doesn\u2019t have campaigns
#Except: Marketing, Marketing &partner\u2013Doesn\u2019t have partners
#Note: Showing number of times campaign got redistributed count.
#\u2014----------------------------------------------------------------------------------------------------------


highlevelanalytics.redistributedCampaign=with a as (select distinct \
cp1.company_id as pid, \
cp1.company_name as \"partnersCompanyName\", \
p.campaign_name as \"vendorCampaignName\", \
c.campaign_id as campaign_id, \
c.campaign_name as \"redistributedCampaignName\", \
c.campaign_type as \"redistributedCampaignType\", \
c.campaign_schedule_type as \"redistributedCampaignScheduleType\", \
c.launch_time as \"redistributedDate\", \
count(distinct cul.user_id) as \"totalRecipients\", \
count(distinct el.user_id ) as \"activeRecipients\", \
count (distinct case when el.action_id = 13 and el.url_id is null and el.reply_id is null and el.video_id is null \
then el.user_id end) \"emailOpened\", \
count(distinct case when (el.action_id = 14 or el.action_id = 15) and el.url_id is null and el.reply_id is null \
then el.user_id end) \"emailClicked\", \
count(distinct case when el.action_id = 13 and (el.reply_id is not null or  el.url_id is not null) \
then el.user_id end) as \"autoResponsesOpened\" \
from \
xt_campaign p \
left join xt_campaign c on(p.campaign_id=c.parent_campaign_id) \
left join xt_user_profile ud on(p.customer_id=ud.user_id) \
left join xt_company_profile cp on(cp.company_id=ud.company_id) \
left join xt_user_profile ud1 on(c.customer_id=ud1.user_id) \
left join xt_company_profile  cp1 on(ud1.company_id=cp1.company_id) \
left join xt_campaign_user_userlist cul on(cul.campaign_id=c.campaign_id) \
left join xt_email_log el on(c.campaign_id=el.campaign_id and cul.user_id=el.user_id) \
where ud.company_id=${getCompanyIdByUserIdQuery} \
and c.vendor_organization_id=${getCompanyIdByUserIdQuery} \
and c.is_launched=true \
And c.is_nurture_campaign=true \
and c.campaign_id is not null \
group by 1,2,3,4,5 \
order by c.launch_time desc \
),b as (select created_by_company_id ,campaign_id,count(distinct id) as leads \
from xt_lead xl where created_for_company_id = ${getCompanyIdByUserIdQuery} group by 1,2) \
select distinct \
\"partnersCompanyName\", \
\"vendorCampaignName\", \
\"redistributedCampaignName\", \
\"redistributedCampaignType\", \
\"redistributedCampaignScheduleType\", \
\"redistributedDate\", \
\"totalRecipients\", \
\"activeRecipients\", \
\"emailOpened\", \
\"emailClicked\", \
\"autoResponsesOpened\", \
 coalesce( b.leads,0) as \"leads\" \
from a left join b on a.pid = b.created_by_company_id \
and a.campaign_id=b.campaign_id \
order by \"redistributedDate\" desc \


#Total Campaigns Launched(To Campaigns)- company wise-All Roles(Except Partner Role)-Detail Report\u2013for bar chart\u2014

highlevelanalytics.toCampaign=select distinct  c.campaign_name as \"campaignName\", c.campaign_type as \"campaignType\",c.campaign_schedule_type as \"campaignSheduleType\",c.launch_time as \"launchTime\", count(distinct p.campaign_id) as \"count\" \
from \
xt_campaign c \
left join xt_campaign p on (c.campaign_id=p.parent_campaign_id) \
left join xt_user_profile up on (up.user_id=c.customer_id) \
where up.company_id=${getCompanyIdByUserIdQuery} \
and c.is_launched = true \
and c.is_channel_campaign = false \
and c.is_nurture_campaign = false \
and c.campaign_id is not null \
group by 1,2,3,4 \
order by 5 desc \



#TeamMember Queries

#9.Inactive Partners: (Partners who doesn\u2019t redistribute campaigns and without company profile)-company wise-Team Member-detail report

highlevelanalytics.inActicePartnerTeamMemberReportsQuery= select distinct u.user_id as\"userId\",cp.company_name as \"companyName\" ,u.email_id as \"emailId\", max(uul.firstname) as \"firstName\",max(uul.lastname) as \"lastName\" \
from xt_user_profile u inner join xt_partnership pc on(pc.partner_id = u.user_id)  \
left outer join xt_company_profile cp on(u.company_id= cp.company_id)  \
left outer join xt_user_userlist uul on(u.user_id = uul.user_id) \
left outer join  xt_user_list ul on (ul.user_list_id = uul.user_list_id) \
 where  pc.status = 'approved' and u.user_id not in  \
(select customer_id from xt_campaign where is_nurture_campaign = true  \
 and is_launched = true and vendor_organization_id =${getCompanyIdByUserIdQuery})  \
 and u.user_id not in(select distinct partner_id from xt_partnership where partner_id in( \
 select distinct org_admin_id from xt_team_member where team_member_id in (select distinct customer_id \
 from xt_campaign where is_nurture_campaign = true  \
 and is_launched = true and vendor_organization_id=${getCompanyIdByUserIdQuery}))and vendor_company_id= ${getCompanyIdByUserIdQuery}) \
 and uul.user_id in (select distinct p.partner_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
	left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
	and p.partner_id is not null and p.status = 'approved') and pc.vendor_company_id=${getCompanyIdByUserIdQuery} \
	group by 1,2,3



#8.Active Partnership-(Partners who redistribute atleast one campaign and with a company profile)-Company wise-Team Member-detail report

highlevelanalytics.acticePartnerTeamMemberReportsQuery=with pc1 as( \
select  v_com,customer_id,company_id,p_com,user_id,email_id,firstname,lastname,datereg,datelastlogin \
,campaign_name as first_campaign_name,launch_time as first_campaign_launch_time,OrgAdmin,is_launched from ( \
select distinct xcp.company_name as v_com ,xc1.customer_id,xup1.user_id,xup1.email_id,xup1.firstname,xup1.lastname,xup1.datereg,xup1.datelastlogin \
,xup1.company_id,xcp1.company_name as p_com,xc1.campaign_name,xc1.launch_time,OrgAdmin.email_id as OrgAdmin,xc1.is_launched \
,row_number()over(partition by xup1.company_id order by xc1.launch_time) rn \
from public.xt_campaign xc \
left join xt_user_profile xup on (xc.customer_id = xup.user_id) \
left join xt_company_profile xcp on (xup.company_id = xcp.company_id) \
left join xt_campaign xc1 on (xc.campaign_id = xc1.parent_campaign_id) \
left join xt_user_profile xup1 on (xc1.customer_id = xup1.user_id) \
left join xt_company_profile xcp1 on (xup1.company_id = xcp1.company_id) \
left join (select * from public.xt_user_profile where user_id in \
(select user_id from public.xt_user_role where role_id=12  )) OrgAdmin on(OrgAdmin.company_id=xcp1.company_id) \
where xc1.is_launched='true' and xc1.vendor_organization_id=${getCompanyIdByUserIdQuery} \
and xup1.company_id in (select distinct p.partner_company_id from  xt_team_member t \
left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
left outer join xt_partnership p on ptgm.partnership_id=p.id \
left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
where t.team_member_id = :userId \
and p.partner_id is not null and p.status = 'approved' \
)  and xup.company_id=${getCompanyIdByUserIdQuery}) fc where rn = 1), \
pc3 as ( \
select v_com,customer_id,company_id,p_com,user_id,email_id,firstname,lastname,datereg,datelastlogin \
,campaign_name as recent_campaign_name,launch_time as recent_campaign_launch_time from ( \
select distinct xcp.company_name as v_com ,xc1.customer_id,xup1.user_id,xup1.email_id,xup1.firstname,xup1.lastname,xup1.datereg,xup1.datelastlogin \
,xup1.company_id,xcp1.company_name as p_com,xc1.campaign_name,xc1.launch_time \
,row_number()over(partition by xup1.company_id order by xc1.launch_time desc) rn \
from public.xt_campaign xc \
left join xt_user_profile xup on (xc.customer_id = xup.user_id) \
left join xt_company_profile xcp on (xup.company_id = xcp.company_id) \
left join xt_campaign xc1 on (xc.campaign_id = xc1.parent_campaign_id) \
left join xt_user_profile xup1 on (xc1.customer_id = xup1.user_id) \
left join xt_company_profile xcp1 on (xup1.company_id = xcp1.company_id) \
  where xc1.is_launched='true' and xc1.vendor_organization_id=${getCompanyIdByUserIdQuery} \
  and xup1.company_id in (select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
and p.partner_id is not null and p.status = 'approved' \
)  and xup.company_id=${getCompanyIdByUserIdQuery})  rc where rn = 1 \
order by p_com), \
c as \
(select count(distinct c.campaign_id) as red_campaigns, up1.company_id \
from \
xt_campaign p \
left join xt_campaign c on (p.campaign_id=c.parent_campaign_id) \
left join xt_user_profile up on (up.user_id=p.customer_id) \
left join xt_company_profile cp on (up.company_id=cp.company_id) \
left join xt_user_profile up1 on (up1.user_id=c.customer_id) \
left join xt_company_profile cp1 on (up1.company_id=cp1.company_id) \
where  c.is_launched =true and c.vendor_organization_id=${getCompanyIdByUserIdQuery} \
 and c.is_nurture_campaign = true and up1.company_id in (select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
and p.partner_id is not null  and p.status = 'approved' \
)  and up.company_id=${getCompanyIdByUserIdQuery} \
group by 2) \
select distinct pc1.v_com as \"vendorCompanyName\",pc1.p_com as \"partnerCompanyName\",pc1.user_id as \"userId\", \
pc1.email_id as \"emailId\" \
,pc1.firstname as \"firstName\",pc1.lastname as \"lastName\" \
,pc1.first_campaign_name as \"firstCampaignName\",pc1.first_campaign_launch_time as \"firstCampaignlaunchedTime\" \
,pc3.recent_campaign_name as \"recentCampaignName\",pc3.recent_campaign_launch_time as \"recentCampaignLaunchedTime\", \
c.red_campaigns as \"redistributedCampaignId\" \
from pc1 \
left join pc3 on (pc3.company_id=pc1.company_id) \
left join c on pc3.company_id=c.company_id \




#Partnership with Company profile(partners with a company profile)- company wise-Team Member\u2014---Detail report\u2014--


highlevelanalytics.onBoardPartnerTeamMemberFilter=select \
cp.company_name as \"companyName\", up.email_id as \"email\", up.firstname as \"firstname\",up.lastname as \"lastname\" \
from xt_partnership p \
left join xt_user_profile up on p.partner_id=up.user_id \
left join xt_company_profile cp on up.company_id=cp.company_id \
where p.partner_company_id in (select distinct p.partner_company_id from  xt_team_member t  left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id  left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id =:userId \
and p.partner_id is not null \
and p.status = 'approved') \
and p.vendor_company_id= ${getCompanyIdByUserIdQuery} \
and p.partner_company_id is not null \


#Total Campaigns Redistributed by all partner companies(how many times it got redistributed that count we are showing)--company-wise \u2014Team Member\u2014-detail Report


highlevelanalytics.totalRedistributedCampaignsTeamMemberFilter=with a as ( \
select distinct \
cp1.company_id as pid, \
cp1.company_name as \"partnersCompanyName\", \
c.campaign_name as \"vendorCampaignName\", \
p.campaign_id as campaign_id, \
p.campaign_name as \"redistributedCampaignName\", \
p.campaign_type as  \"redistributedCampaignType\", \
p.campaign_schedule_type as \"redistributedCampaignScheduleType\", \
p.launch_time as \"redistributedDate\", \
count(distinct cul.user_id) as \"totalRecipients\", \
count(distinct el.user_id )as \"activeRecipients\", \
count (distinct case when el.action_id = 13 and el.url_id is null and el.reply_id is null and el.video_id is null \
then el.user_id end) \"emailOpened\", \
count(distinct case when (el.action_id = 14 or el.action_id = 15) and el.url_id is null and el.reply_id is null \
then el.user_id end) \"emailClicked\", \
count(distinct case when el.action_id = 13 and (el.reply_id is not null or  el.url_id is not null) \
then el.user_id end) as \"autoResponsesOpened\" \
from \
xt_campaign c \
left join xt_campaign p on(c.campaign_id=p.parent_campaign_id) \
left join xt_user_profile ud on(c.customer_id=ud.user_id) \
left join xt_company_profile cp on(cp.company_id=ud.company_id) \
left join xt_user_profile ud1 on(p.customer_id=ud1.user_id) \
left join xt_company_profile  cp1 on(ud1.company_id=cp1.company_id) \
left join xt_campaign_user_userlist cul on(cul.campaign_id=p.campaign_id) \
left join xt_email_log el on(p.campaign_id=el.campaign_id and cul.user_id=el.user_id) \
where ud1.company_id in (select distinct p.partner_company_id from  xt_team_member t \
left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
left outer join xt_partnership p on ptgm.partnership_id=p.id  \
where t.team_member_id = :userId \
and p.partner_id is not null \
and p.status = 'approved') \
and ud.company_id=${getCompanyIdByUserIdQuery} \
and p.vendor_organization_id=${getCompanyIdByUserIdQuery} \
and p.is_launched=true \
And p.is_nurture_campaign=true \
and p.campaign_id is not null \
group by 1,2,3,4,5 \
order by p.launch_time desc \
),b as (select created_by_company_id ,campaign_id,count(distinct id) as leads \
from xt_lead xl where created_by_company_id in  \
(select distinct p.partner_company_id from  xt_team_member t  \
left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id  \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id left outer join xt_partnership p on ptgm.partnership_id=p.id  \
where t.team_member_id = :userId \
and p.partner_id is not null and p.status = 'approved') and created_for_company_id =${getCompanyIdByUserIdQuery} group by 1,2) \
select distinct \
\"partnersCompanyName\", \
\"vendorCampaignName\", \
\"redistributedCampaignName\", \
\"redistributedCampaignType\", \
\"redistributedCampaignScheduleType\", \
\"redistributedDate\", \
\"totalRecipients\", \
\"activeRecipients\", \
\"emailOpened\", \
\"emailClicked\", \
\"autoResponsesOpened\", \
 coalesce( b.leads,0) as leads \
from a left join b on a.pid = b.created_by_company_id \
and a.campaign_id=b.campaign_id \
order by \"redistributedDate\" desc \


#Partners Query:
highlevelanalytics.partnerQuery=select cast(count(distinct p.partner_id) as int) as \"partner\" from \
xt_partnership p where p.vendor_company_id=${getCompanyIdByUserIdQuery} and p.status = 'approved' and p.partner_id is not null \



#Team Members query:
highlevelanalytics.teamMemberQuery=select cast( count(distinct xtm.team_member_id)as int )as \"teamMembers\" from \
xt_partnership p left join xt_team_member xtm on (p.partner_id=xtm.org_admin_id) \
where p.vendor_company_id=${getCompanyIdByUserIdQuery}  and p.status = 'approved' and xtm.team_member_id is not null \


#Partners query: Seperately
highlevelanalytics.partnerLoggedAsTeamMember=select cast(count(a ) as int)  from \
(select distinct p.partner_id \
from  xt_team_member t \
left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
left outer join xt_partnership p on ptgm.partnership_id=p.id \
left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
where t.team_member_id = :userId \
and p.partner_id is not null \
and p.status = 'approved' )a \


#Team member query : seperately
highlevelanalytics.teamMemberLoggedAsTeamMember=select cast(count(a ) as int)  from(select distinct xtm.team_member_id as "team members" \
from \
xt_partnership p \
left join xt_team_member xtm on (p.partner_id=xtm.org_admin_id) \
where p.partner_id in  (select distinct p.partner_id \
from  xt_team_member t \
left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
left outer join xt_partnership p on ptgm.partnership_id=p.id \
left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
where t.team_member_id = :userId \
and p.partner_id is not null and p.status = 'approved') and p.vendor_company_id=${getCompanyIdByUserIdQuery} and xtm.team_member_id is not null) a \


#\u2014----Total Contacts \u2014----company wise\u2014----Marketing Role ,Marketing&Partner Role----
#Detail Report:

highlevelanalytics.totalContactsForMarketing=select distinct xup.email_id as \"emailId\",max(uul.firstname) as \"firstName\" ,max(uul.lastname) as \"lastName\", max(uul.country) as \"country\",uul.address as \"address\",max( uul.mobile_number) as \"mobileNumber\" \
from \
xt_user_list ul \
left join xt_user_userlist uul on (uul.user_list_id= ul.user_list_id ) \
left join xt_user_profile xup on (xup.user_id=uul.user_id) \
where ul.is_partner_userlist=false \
and uul.user_id is not null \
and ul.module_name = 'CONTACTS' \
and ul.email_validation_ind=true \
and ul.company_id=${getCompanyIdByUserIdQuery} \
group by 1,5


#Total Share Leads company wise- All Roles-Detailed Report
#\u2014---Total Share Leads Detail Report\u2014----------------------------1 st drill\u2014--

highlevelanalytics.shareLeadsOfFirstDrill=SELECT distinct cp.company_name as \"vendorCompanyName\", \
cp1.company_name as \"partnerCompanyName\", \
count(distinct xul.user_list_id) as \"shareLeadsList\" \
From  xt_user_profile u \
left join xt_user_list xul  on u.user_id = xul.assigned_by \
AND xul.module_name = 'SHARE LEADS' \
left join xt_user_userlist xuu on xul.user_list_id = xuu.user_list_id left join  xt_user_profile u1 on u1.user_id = xuu.user_id \
left join xt_sharelist_partner sp on sp.user_list_id  = xul.user_list_id  \
left join xt_sharelist_partner_mapping spm  on sp.id =spm.sharelist_partner_id left join xt_company_profile cp on cp.company_id = xul.assigned_company_id \
left join xt_company_profile cp1 on cp1.company_id = xul.company_id  \
where xul.assigned_company_id=${getCompanyIdByUserIdQuery} \
group by 1,2 \

#\u2014\u2014---Total Share Leads Detail Report\u2014---------Team Member--------1 st drill\u2014--

highlevelanalytics.shareLeadsOfFirstDrillAsTeamMember=select ul.company_id as \"companyId\",xcp.company_name as \"partnerCompanyName\", count(distinct ul.user_list_id) as \"shareLeadsList\" \
from xt_user_list ul \
left join xt_user_userlist uul on ul.user_list_id =uul.user_list_id \
left join xt_user_profile up on uul.user_id=up.user_id \
left join xt_company_profile xcp on xcp.company_id=ul.company_id \
where ul.company_id in \
(select distinct p.partner_company_id from  xt_team_member t \
left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id left outer join xt_partnership p on ptgm.partnership_id=p.id \
left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
where t.team_member_id = :userId \
and p.partner_id is not null) \
and ul.is_partner_userlist= false \
and ul.module_name = 'SHARE LEADS' \
and ul.assigned_company_id= ${getCompanyIdByUserIdQuery} \
and ul.email_validation_ind = true \
and up. email_validation_ind=true \
and ul.company_id in (select distinct partner_company_id from xt_partnership \
where vendor_company_id=${getCompanyIdByUserIdQuery}) \
group by 1,2 \



#---------------------------------------Share Leads Detail Report--------------------2nd drill\u2014----------

highlevelanalytics.shareLeadsOfSecondDrill=SELECT distinct cp.company_name as \"vendorCompanyName\", \
cp1.company_name as \"partnerCompanyName\", \
xul.user_list_name as \"userListName\", \
cast(count(DISTINCT xuu.user_id) as integer) as \"numberOfShareLeads\" \
From  xt_user_profile u \
left join xt_user_list xul  on u.user_id = xul.assigned_by \
AND xul.module_name = 'SHARE LEADS' \
left join xt_user_userlist xuu on xul.user_list_id = xuu.user_list_id  \
left join  xt_user_profile u1 on u1.user_id = xuu.user_id \
left join xt_sharelist_partner sp on sp.user_list_id  = xul.user_list_id \
left join xt_sharelist_partner_mapping spm  on sp.id =spm.sharelist_partner_id left join xt_company_profile cp on cp.company_id = xul.assigned_company_id \
left join xt_company_profile cp1 on cp1.company_id = xul.company_id \
where xul.assigned_company_id=${getCompanyIdByUserIdQuery} \
GROUP BY 1,2,3 \

#---------Share Leads Detail Report-------------2nd drill\u2014--------Team Member\u2013



highlevelanalytics.shareLeadsOfSecondDrillAsTeamMember=select ul.company_id as \"companyId\",xcp.company_name as \"partnerCompanyName\", ul.user_list_id as \"leadsList\",ul.user_list_name as \"userListName\", \
count(distinct up.user_id) as \"shareLeadsList\" \
from xt_user_list ul \
left join xt_user_userlist uul on ul.user_list_id =uul.user_list_id \
left join xt_user_profile up on uul.user_id=up.user_id \
left join xt_company_profile xcp on xcp.company_id=ul.company_id \
where ul.company_id in (select distinct p.partner_company_id from  xt_team_member t \
left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
left outer join xt_partnership p on ptgm.partnership_id=p.id \
left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
where t.team_member_id =  :userId \
and p.partner_id is not null) \
and ul.is_partner_userlist= false \
and ul.module_name = 'SHARE LEADS' \
and ul.assigned_company_id= ${getCompanyIdByUserIdQuery} \
and ul.email_validation_ind = true \
and up. email_validation_ind=true \
and ul.company_id in (select distinct partner_company_id from xt_partnership) \
group by 1,2,3,4 \





#-----------Share Leads Detail Report------------------------------------------3rd drill------

highlevelanalytics.shareLeadsOfThirdDrill=SELECT distinct cp.company_name as \"vendorCompanyName\", \
cp1.company_name as \"partnerCompanyName\", \
xul.user_list_name as \"userListName\", \
u1.email_id  as \"leadEmailId\" \
From  xt_user_profile u \
left join xt_user_list xul  on u.user_id = xul.assigned_by \
AND xul.module_name = 'SHARE LEADS' \
left join xt_user_userlist xuu on xul.user_list_id = xuu.user_list_id  \
left join  xt_user_profile u1 on u1.user_id = xuu.user_id \
left join xt_sharelist_partner sp on sp.user_list_id  = xul.user_list_id  \
left join xt_sharelist_partner_mapping spm  on sp.id =spm.sharelist_partner_id left join xt_company_profile cp on cp.company_id = xul.assigned_company_id \
left join xt_company_profile cp1 on cp1.company_id = xul.company_id  \
where xul.assigned_company_id=${getCompanyIdByUserIdQuery} \

#---------Share Leads Detail Report-------------3rd drill\u2014--------Team Member\u2013


highlevelanalytics.shareLeadsOfThirdDrillAsTeamMember=select distinct ul.user_list_id as \"userListId\",ul.user_list_name as \"userListName\",up.email_id as \"leadEmailId\", concat(uul.firstname, ' ' , uul.lastname) as \"leadName\" \
from xt_user_list ul \
left join xt_user_userlist uul on ul.user_list_id =uul.user_list_id \
left join xt_user_profile up on uul.user_id=up.user_id \
left join xt_company_profile xcp on xcp.company_id=ul.company_id \
where ul.company_id in \
(select distinct p.partner_company_id from  xt_team_member t \
left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
left outer join xt_partnership p on ptgm.partnership_id=p.id  \
left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
where t.team_member_id = :userId \
and p.partner_id is not null) \
and ul.is_partner_userlist= false \
and ul.module_name = 'SHARE LEADS' \
and ul.assigned_company_id= ${getCompanyIdByUserIdQuery} \
and ul.email_validation_ind = true \
and up. email_validation_ind=true \
and ul.company_id in (select distinct partner_company_id from xt_partnership where vendor_company_id=${getCompanyIdByUserIdQuery}) \






