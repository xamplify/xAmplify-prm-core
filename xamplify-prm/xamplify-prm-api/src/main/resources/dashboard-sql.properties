#Contacts Analytics TreeMap
getCompanyIdByUserIdQuery = (select company_id from xt_user_profile where user_id=:userId)

dashboard.contactsAnalyticsTreeMapQueryDep = select distinct xcp1.company_name as \"name\",count (distinct case when (xul1.is_partner_userlist=false and xul1.contact_type!='ASSIGNED_LEADS_LIST' )then xuul1.user_id end) \
 as \"value"\ from xt_user_profile xup left join xt_company_profile xcp on (xup.company_id=xcp.company_id) left join xt_user_list xul on (xul.customer_id=xup.user_id) \
left join xt_user_userlist xuul on (xul.user_list_id=xuul.user_list_id) left join xt_user_profile xup1 on (xup1.user_id=xuul.user_id) \
left join xt_company_profile xcp1 on (xup1.company_id=xcp1.company_id) left join xt_user_list xul1 on (xul1.customer_id=xup1.user_id) \
left join xt_user_userlist xuul1 on (xul1.user_list_id=xuul1.user_list_id) where xup.company_id= ${getCompanyIdByUserIdQuery}  and xcp1.company_name is not null \
and xcp.company_id!=xcp1.company_id group by 1 order by 2 desc

dashboard.contactsAnalyticsTreeMapFilterQueryDep = select distinct xcp1.company_name as \"name\",count (distinct case when (xul1.is_partner_userlist=false and xul1.contact_type!='ASSIGNED_LEADS_LIST' )then xuul1.user_id end) \
 as \"value"\ from xt_user_profile xup left join xt_company_profile xcp on (xup.company_id=xcp.company_id) left join xt_user_list xul on (xul.customer_id=xup.user_id) \
left join xt_user_userlist xuul on (xul.user_list_id=xuul.user_list_id) left join xt_user_profile xup1 on (xup1.user_id=xuul.user_id) \
left join xt_company_profile xcp1 on (xup1.company_id=xcp1.company_id) left join xt_user_list xul1 on (xul1.customer_id=xup1.user_id) \
left join xt_user_userlist xuul1 on (xul1.user_list_id=xuul1.user_list_id) where xup.company_id= ${getCompanyIdByUserIdQuery}  and xcp1.company_name is not null \
and xcp.company_id!=xcp1.company_id ${partnerCompanyIdsFilterQuery} group by 1 order by 2 desc

#Added On 28/05/2024 Sushma
dashboard.contactsAnalyticsTreeMapQuery = select distinct xcp.company_name as \"name\", count(distinct xuul.user_id) as \"value"\ from xt_partnership p \
 join xt_company_profile xcp on xcp.company_id= p.partner_company_id inner join xt_user_list xul on p.partner_company_id=xul.company_id inner join \
  xt_user_userlist xuul on xuul.user_list_id=xul.user_list_id where p.vendor_company_id=:companyId and xul.email_validation_ind = true \
and xul.module_name ='CONTACTS' and p.status ='approved' group by 1 order by 2 desc
-------------

#Added On 28/05/2024 Sushma
dashboard.contactsAnalyticsTreeMapFilterQuery = select distinct xcp.company_name as \"name\", count(distinct xuul.user_id) as \"value"\ from xt_partnership p \
 join xt_company_profile xcp on xcp.company_id= p.partner_company_id inner join xt_user_list xul on p.partner_company_id=xul.company_id inner join \
  xt_user_userlist xuul on xuul.user_list_id=xul.user_list_id where p.vendor_company_id=:companyId and p.partner_company_id in (:partnerCompanyIds) and xul.email_validation_ind = true \
and xul.module_name ='CONTACTS' and p.status ='approved' group by 1 order by 2 desc

#Total,Active,InActive Partners
dashboard.partnerAnalyticsCountQuery = select count(distinct case when xul.is_partner_userlist= true then xuul.user_id end ) as \"totalPartners\", \
count (distinct case when xc1.campaign_id is not null  then xup2.company_id end) as \"activePartners\", \
(count(distinct case when xul.is_partner_userlist= true then xuul.user_id end )-count \
(distinct case when xc1.campaign_id is not null then xup2.company_id end)) as \"inActivePartners\" \
from xt_user_profile xup left join xt_company_profile xcp on (xup.company_id=xcp.company_id) \
left join xt_campaign xc on (xc.customer_id=xup.user_id) left join xt_campaign xc1 on \
(xc.campaign_id=xc1.parent_campaign_id) left join xt_user_list xul on (xul.customer_id=xup.user_id) \
left join xt_user_userlist xuul on (xul.user_list_id=xuul.user_list_id)left join xt_user_profile xup1 \
 on (xup1.user_id=xuul.user_id) left join xt_user_profile xup2 on (xup2.user_id=xc1.customer_id) \
left join xt_company_profile xcp1 on (xup1.company_id=xcp1.company_id) where xc1.is_launched=true \
and xup.company_id= ${getCompanyIdByUserIdQuery} and xcp.company_id!=xcp1.company_id

#Total Contacts Of All Partners
---------------------
dashboard.totalPartnerContactsQueryDep = select sum(\"allContacts\") as \"usedContacts\" from (select xcp1.company_id,count(distinct  case when (xul1.contact_type!= 'ASSIGNED_LEADS_LIST' \
and  xul1.is_partner_userlist=false) then xuul1.user_id end) as \"allContacts\" from xt_user_profile xup left join xt_company_profile xcp on (xup.company_id=xcp.company_id) \
left join xt_user_list xul on (xul.customer_id=xup.user_id) left join xt_user_userlist xuul on (xul.user_list_id=xuul.user_list_id) left join xt_user_profile xup1 on (xup1.user_id=xuul.user_id) \
left join xt_company_profile xcp1 on (xup1.company_id=xcp1.company_id) left join xt_user_list xul1 on (xul1.customer_id=xup1.user_id) left join xt_user_userlist xuul1 on (xul1.user_list_id=xuul1.user_list_id) \
where xup.company_id= ${getCompanyIdByUserIdQuery} and xcp.company_id!=xcp1.company_id group by 1)a

dashboard.totalPartnerContactsFilterQueryDep = select sum(\"allContacts\") as \"usedContacts\" from (select xcp1.company_id,count(distinct  case when (xul1.contact_type!= 'ASSIGNED_LEADS_LIST' \
and  xul1.is_partner_userlist=false) then xuul1.user_id end) as \"allContacts\" from xt_user_profile xup left join xt_company_profile xcp on (xup.company_id=xcp.company_id) \
left join xt_user_list xul on (xul.customer_id=xup.user_id) left join xt_user_userlist xuul on (xul.user_list_id=xuul.user_list_id) left join xt_user_profile xup1 on (xup1.user_id=xuul.user_id) \
left join xt_company_profile xcp1 on (xup1.company_id=xcp1.company_id) left join xt_user_list xul1 on (xul1.customer_id=xup1.user_id) left join xt_user_userlist xuul1 on (xul1.user_list_id=xuul1.user_list_id) \
where xup.company_id= ${getCompanyIdByUserIdQuery} and xcp.company_id!=xcp1.company_id ${partnerCompanyIdsFilterQuery} group by 1)a

#Added On 28/05/2024 By Sushma
dashboard.totalPartnerContactsQuery = select  count(distinct xuul.user_id) as \"usedContacts\" from xt_partnership p left join xt_user_list xul on \
p.partner_company_id =xul.company_id left join xt_user_userlist xuul on xuul.user_list_id=xul.user_list_id where p.vendor_company_id=:companyId \
 and xul.email_validation_ind = true and xul.module_name ='CONTACTS' and p.status ='approved'

#Added On 28/05/2024 By Sushma
dashboard.totalPartnerContactsFilterQuery = select  count(distinct xuul.user_id) as \"usedContacts\" from xt_partnership p left join xt_user_list xul on \
p.partner_company_id =xul.company_id left join xt_user_userlist xuul on xuul.user_list_id=xul.user_list_id where p.vendor_company_id=:companyId \
 and xul.email_validation_ind = true and xul.module_name ='CONTACTS' and p.status ='approved'  and p.partner_company_id in (:partnerCompanyIds)


#PartnerCompanyNamesAndRedistributedCampaignsCount
-----------------------------------------------------
dashboard.partnerCompanyNamesAndRedistributedCampaignsCountQuery =  ${dashboard.partnerCompanyNamesAndRedistributedCampaignsCountQueryPrefix} ${dashboard.partnerCompanyNamesAndRedistributedCampaignsCountQuerySuffix}

dashboard.partnerCompanyNamesAndRedistributedCampaignsCountFilterQuery =  ${dashboard.partnerCompanyNamesAndRedistributedCampaignsCountQueryPrefix} \
 ${partnerCompanyIdsFilterQuery} ${dashboard.partnerCompanyNamesAndRedistributedCampaignsCountQuerySuffix} 



dashboard.partnerCompanyNamesAndRedistributedCampaignsCountQueryPrefix =  select distinct xcp1.company_name as \"name\",count (distinct xc1.campaign_id) as \"weight\" from  xt_campaign xc \
left join xt_user_profile xup on (xc.customer_id=xup.user_id) left join xt_company_profile xcp on (xup.company_id=xcp.company_id) \
left join xt_campaign xc1 on (xc.campaign_id=xc1.parent_campaign_id ) left join xt_user_profile xup1 ON (xc1.customer_id = xup1.user_id) \
left join xt_company_profile xcp1 ON (xup1.company_id = xcp1.company_id) where xup.company_id=  ${getCompanyIdByUserIdQuery} and \
xcp1.company_name is not null and xc1.vendor_organization_id is not null and xc1.is_launched= true  and  xc1.is_nurture_campaign =  true \
and xc1.parent_campaign_id is not null and xcp.company_id!=xcp1.company_id

dashboard.partnerCompanyNamesAndRedistributedCampaignsCountQuerySuffix = group by 1 order by 2 desc

#LeadStatisticsBubbleChart
-------------------------------------------------
dashboard.leadBubbleChartQuery =select c.company_name as \"name\",count(l.id) as \"weight\" from  xt_lead l,xt_company_profile c \
where l.created_for_company_id = ${getCompanyIdByUserIdQuery} and l.created_by_company_id!=${getCompanyIdByUserIdQuery} and l.created_by_company_id = c.company_id \
group by c.company_name,c.company_id order by \"weight\" desc limit 10

dashboard.leadBubbleChartFilterQuery =select c.company_name as \"name\",count(l.id) as \"weight\" from  xt_lead l,xt_company_profile c \
where l.created_for_company_id = ${getCompanyIdByUserIdQuery} and l.created_by_company_id!=${getCompanyIdByUserIdQuery} and l.created_by_company_id = c.company_id \
and c.company_id in (:partnerCompanyIds) group by c.company_name,c.company_id order by \"weight\" desc limit 10


#DealStatisticsBubbleChart
--------------------------------------------------------
dashboard.dealBubbleChartQuery = select c.company_name as \"name\",count (d.id) as \"weight\" from  xt_deal d,xt_company_profile c \
where d.created_for_company_id = ${getCompanyIdByUserIdQuery} and d.created_by_company_id!=${getCompanyIdByUserIdQuery} and d.created_by_company_id = c.company_id  \
group by c.company_name,c.company_id order by \"weight\" desc limit 10

dashboard.dealBubbleChartFilterQuery = select c.company_name as \"name\",count (d.id) as \"weight\" from  xt_deal d,xt_company_profile c \
where d.created_for_company_id = ${getCompanyIdByUserIdQuery} and d.created_by_company_id!=${getCompanyIdByUserIdQuery} and d.created_by_company_id = c.company_id  \
and c.company_id in (:partnerCompanyIds) group by c.company_name,c.company_id order by \"weight\" desc limit 10

partnerCompanyIdsFilterQuery = and xcp1.company_id in (:partnerCompanyIds)


#FunnelChartAnalytics
---------------------------------------------------------------------------
##contacts
-------------------------


#--------------Orgadmin Queries----------------
#--------Orgadmin recipients for xAmplify Login / Own Vanity Login-----
dashboard.orgAdminContactsQuery=select cast(count(a) as int) as \"recipient\" from \
(select distinct xcuul.user_id \
from xt_campaign c  \
left join xt_campaign p on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist  xcuul on xcuul.campaign_id=p.campaign_id \
left join  xt_user_profile xup on c.customer_id=xup.user_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.is_launched = true \
and p.campaign_id is not null and xcuul.user_id is not null \
union \
select distinct user_id \
from xt_campaign_user_userlist \
where campaign_id in (select distinct campaign_id  \
from xt_campaign \
where is_channel_campaign = false \
and is_nurture_campaign=false \
and is_launched =true \
and  customer_id in( \
select distinct user_id \
from  xt_user_profile \
where company_id=${getCompanyIdByUserIdQuery})) )a

#----------------- OrgAdmin Leads for xAmplify Login / Own Vanity Login------------
dashboard.orgAdminLeadsforxAmplifyLoginOrOwnVanityLogin =select cast(count(distinct xl.id ) as int) as \"lead\" \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery}

#----------------- OrgAdmin Deals for xAmplify Login / Own Vanity Login------------
dashboard.orgAdminDealsforxAmplifyLoginOrOwnVanityLogin=select cast(count(distinct xd.id ) as int) as \"Deals\" \
 from  xt_company_profile xcp \
left join xt_deal xd on   xd.created_for_company_id =xcp.company_id \
where xd.created_for_company_id= ${getCompanyIdByUserIdQuery} 


#------------- OrgAdmin Won Deals for xAmplify Login / Own Vanity Login-----------------
dashboard.orgAdminDealsWonforxAmplifyLoginOrOwnVanityLogin=select cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery}

#-----pie orgadmin--
#vendor/orgadmin won leads (pie won leads for vendor vanity login)
----------------------
dashboard.vendorLeadsWonForOwnVanityLoginPieChart=select \
cast(count (distinct case when xps.is_won = true then xl.id end) as int) as \"Won Leads\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \

dashboard.vendorLeadsWonPieChart=${dashboard.vendorLeadsWonForOwnVanityLoginPieChart} \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery} \

#-----(pie won leads for vendor vanity login)----
dashboard.leadsWonQueryForVendorVanityLoginOfPieChart = ${dashboard.vendorLeadsWonForOwnVanityLoginPieChart} \
${dashboard.partnerVanityLoginWhereCondition} \




#vendor/oradmin  Lost Leads 
---------------
dashboard.vendorLeadsLostForOwnVanityLoginPieChart=select \
cast(count(distinct case when xps.is_lost= true then xl.id end ) as int) as \"Lost Leads\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \

dashboard.vendorLeadsLostPieChart= ${dashboard.vendorLeadsLostForOwnVanityLoginPieChart} where xl.created_for_company_id=${getCompanyIdByUserIdQuery} \

#---(pie lost leads for vendor vanity login for all roles)-----
dashboard.leadsLostQueryForVendorVanityLoginOfPieChart = ${dashboard.vendorLeadsLostForOwnVanityLoginPieChart} ${dashboard.partnerVanityLoginWhereCondition} \


#vendor/oradmin Converted leads
-----------------------------------
dashboard.vendorLeadsConvertedForOwnVanityLoginPieChart=select \
 cast(count(distinct case when xd.associated_lead_id = xl.id  then xl.id end) as int) as \"Converted Leads\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \


dashboard.vendorLeadsConvertedPieChart=${dashboard.vendorLeadsConvertedForOwnVanityLoginPieChart} where xl.created_for_company_id=${getCompanyIdByUserIdQuery} \

#----(pie  leads converted for vendor vanity login for all roles)----
dashboard.leadsConvertedQueryForVendorVanityLoginOfPieChart = ${dashboard.vendorLeadsConvertedForOwnVanityLoginPieChart} ${dashboard.partnerVanityLoginWhereCondition} \

#--Deals-

#vendor/orgadmin DealsWon
--------------------
dashboard.dealsWonQueryForOwnVanityLoginOfPieChart=select \
cast(count (distinct case when xps.is_won = true then xd.id end)as int) as \"Won Deals\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \


dashboard.vendorDealsWonPieChart= ${dashboard.dealsWonQueryForOwnVanityLoginOfPieChart} ${dashboard.dealCreatedForCompanyIdQuery} \

dashboard.dealsWonForAdminAndPartner = ${dashboard.dealsWonQueryForOwnVanityLoginOfPieChart}  where xd.created_for_company_id = ${getCompanyIdByUserIdQuery} or xd.created_by_company_id=${getCompanyIdByUserIdQuery} \


#---(pie deals won for vendor vanity login for all roles)
dashboard.dealsWonQueryForVendorVanityLoginOfPieChart =${dashboard.dealsWonQueryForOwnVanityLoginOfPieChart} ${dashboard.partnerDealVanityLoginWhereCondition}


#vendor/orgadmin Deals Lost
---------------------------------
dashboard.dealLostQueryForOwnVanityLoginOfPieChart=select \
cast(count(distinct case when xps.is_lost= true then xd.id end ) as int) as \"Lost Deals\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \



dashboard.vendorDealsLostPieChart= ${dashboard.dealLostQueryForOwnVanityLoginOfPieChart} ${dashboard.dealCreatedForCompanyIdQuery} \

dashboard.dealsLostForAdminAndPartner=${dashboard.dealLostQueryForOwnVanityLoginOfPieChart} where xd.created_for_company_id = ${getCompanyIdByUserIdQuery} or xd.created_by_company_id=${getCompanyIdByUserIdQuery} \

#----((pie lost deals for vendor vanity login for all roles)----
dashboard.dealsLostQueryForVendorVanityLoginOfPieChart= ${dashboard.dealLostQueryForOwnVanityLoginOfPieChart} ${dashboard.partnerDealVanityLoginWhereCondition} \

#-------------------- OrgAdmin Contacts to Leads Conversion-------------
dashboard.orgAdminContactToLeadConvertion=select concat(round(avg("conversion") ,2) , '%')  as \"Contacts to Leads\" from \
(select distinct p.campaign_id , count(distinct xcuul.user_id),count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign c  left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id= xl.associated_user_id \
left join  xt_user_profile xup on c.customer_id=xup.user_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.campaign_id is not null \
and p.is_launched = true \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group by 1 \
union \
select distinct  c.campaign_id,count(distinct xcuul.user_id),count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/  \
case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign_user_userlist xcuul \
left join  xt_campaign c on xcuul.campaign_id=c.campaign_id \
 left join xt_lead xl on xcuul.campaign_id=xl.campaign_id  and xcuul.user_id= xl.associated_user_id \
  where c.customer_id in( \
select distinct user_id \
from  xt_user_profile \
where company_id=${getCompanyIdByUserIdQuery})  \
and c.campaign_id is not null \
and c.is_launched = true \
and c.is_channel_campaign =false \
and c.is_nurture_campaign=false \
and c.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group by 1 \
)a

#--------------orgAdmin Lead to deal Conversion--------------
dashboard.orgAdminLeadtodealConversion =select \
concat(round((cast (count(distinct xd.id ) as decimal) / \
case when cast(count(distinct xl.id) as decimal) = 0 then 1 else cast (count(distinct xl.id) as decimal) end)*100,2),'%') \
as \"Leads to Deals Conversion %\" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id = xl.created_by_company_id \
left join xt_deal xd on xl.id= xd.associated_lead_id  \
where xl.created_for_company_id = ${getCompanyIdByUserIdQuery} 

#--------------- Vendor/orgadmin Latest Lead Created Time Pie Chart------------
dashboard.vendorLatestLeadCreatedQueryForOwnVanityLoginOfPieChart=select \
max(xl.created_time) as \"Latest Lead Created Time\" from   xt_lead xl \


dashboard.vendorLatestLeadCreatedTimePieChart= ${dashboard.vendorLatestLeadCreatedQueryForOwnVanityLoginOfPieChart} where xl.created_for_company_id=${getCompanyIdByUserIdQuery} \

dashboard.vendorLatestLeadCreatedQueryForVendorVanityLoginOfPieChart=${dashboard.vendorLatestLeadCreatedQueryForOwnVanityLoginOfPieChart} ${dashboard.partnerVanityLoginWhereCondition}

#----------------- Vendor/orgadmin Deal Latest Created Time-----------
dashboard.vendorDealLatestCreatedTimeQueryForOwnVanityLoginOfPieChart=select \
max(xd.created_time) as  \"Latest Deal Created Time\" from xt_deal xd \

dashboard.vendorDealLatestCreatedTimeOfPieChart= ${dashboard.vendorDealLatestCreatedTimeQueryForOwnVanityLoginOfPieChart} where xd.created_for_company_id=${getCompanyIdByUserIdQuery} \


#------------------ Vendor/oradmin Leads Status wise Leads Pie Chart-------------
dashboard.vendorStatuswiseLeadsQueryForOwnVanityLoginOfPieChart=select distinct xps.stage_name as \"name\", cast(count(distinct xl.id) as int) as \"value\" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id=xl.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \

#--(for all admin roles)--

dashboard.vendorStatusWiseLeadsOfPieChart= ${dashboard.vendorStatuswiseLeadsQueryForOwnVanityLoginOfPieChart} where xl.created_for_company_id =${getCompanyIdByUserIdQuery} group by 1 order by 2 desc \

dashboard.vendorStatuswiseLeadsQueryForVendorVanityLoginOfPieChart=${dashboard.vendorStatuswiseLeadsQueryForOwnVanityLoginOfPieChart} ${dashboard.partnerVanityLoginWhereCondition} group by 1 order by 2 desc \


#------------- Vendor/orgadmin Deal Status wise Deals-----------
dashboard.vendorStatuswiseDealQueryForOwnVanityLoginOfPieChart=select distinct xps.stage_name as \"name\", cast(count(distinct xd.id) as int) as \"value\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \

#--(for All admin roles)---------

dashboard.vendorStatusWiseDealsOfPiehart= ${dashboard.vendorStatuswiseDealQueryForOwnVanityLoginOfPieChart} where xd.created_for_company_id =${getCompanyIdByUserIdQuery} group by 1 order by 2 desc \

dashboard.vendorStatuswiseDealQueryForVendorVanityLoginOfPieChart=${dashboard.vendorStatuswiseDealQueryForOwnVanityLoginOfPieChart} ${dashboard.partnerDealVanityLoginWhereCondition} group by 1 order by 2 desc \

#------------Vendor/orgadmin Deal Opportunity Amount-------------
dashboard.vendorDealOpportunityQueryForOwnVanityLoginOfPieChart= select sum(xd.amount) \
as \"Opportunity_amount\"  \
from \
xt_company_profile xcp \
left join public.xt_deal xd on (xcp.company_id = xd.created_by_company_id ) \

#--------opprotunity mount same as vendor/markeing----------

dashboard.vendorDealOpportunityAmountOfPieChart= ${dashboard.vendorDealOpportunityQueryForOwnVanityLoginOfPieChart} where xd.created_for_company_id = ${getCompanyIdByUserIdQuery} \

#------------------OrgAdmin & Partner Queries---------------------------
#------------------ OrgAdmin and Partner with xamplify Login recipients-------------

dashbord.orgAdminAndPartnerXamplifyLogIn=select cast(count(a) as int) as \"recipient\" from \
(select distinct xcuul.user_id \
from xt_campaign c  \
left join xt_campaign p on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join  xt_user_profile xup on c.customer_id=xup.user_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.is_launched = true and p.campaign_id is not null and xcuul.user_id is not null \
union \
select distinct user_id \
from xt_campaign_user_userlist where campaign_id in (select distinct campaign_id  \
from xt_campaign \
where is_channel_campaign = false \
 and is_nurture_campaign=false \
 and is_launched =true \
 and  customer_id in( \
select distinct user_id \
from  xt_user_profile  \
where company_id=${getCompanyIdByUserIdQuery})) \
union \
select distinct  xcuul.user_id \
from   xt_campaign c \
left join  xt_campaign p on    c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_user_profile xup on xup.user_id=p.customer_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.is_nurture_campaign=true \
and p.is_launched = true \
and xcuul.user_id is not null)a \



#----------------- OrgAdmin and Partner with xAmplify Login Leads------------
dashboard.orgAdminAndPartnerWithXAmplifyLoginLeads=select cast(count(distinct xl.id ) as int) as \"leads\"  \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery} \
or xl.created_by_company_id=${getCompanyIdByUserIdQuery} 


#----------------- OrgAdmin and Partner with xAmplify Login Deals------------
dashboard.orgAdminAndPartnerWithXAmplifyLoginDeals=	select cast(count (distinct xd.id ) as int) as \"deals\" \
from  xt_company_profile xcp \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery} \
or  xd.created_by_company_id=${getCompanyIdByUserIdQuery}

#----------------- OrgAdmin and Partner with xAmplify Login Won Deals------------
dashboard.orgAdminAndPartnerWithXAmplifyLoginDealWon=select  cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery} \
or  xd.created_by_company_id=${getCompanyIdByUserIdQuery}


#------------------------PIE CHART-------------------------
#------------ orgAdmin  and Partner Lead Pie chart xamplify login----------
dashboard.orgAdminAndPartnerLeadWonPiechartxamplifylogin=select cast(count (distinct case when xps.is_won = true then xl.id end) as int) as \"Won Leads\" \
from   xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id   \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery} \
or xl.created_by_company_id=${getCompanyIdByUserIdQuery}


dashboard.orgAdminAndPartnerLeadLostPiechartxamplifylogin=select cast(count(distinct case when xps.is_lost= true then xl.id end ) as int) as \"Lost Leads\" \
from   xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery} \
or xl.created_by_company_id=${getCompanyIdByUserIdQuery}

dashboard.orgAdminAndPartnerLeadConvertedPiechartxamplifylogin=select cast(count(distinct case when xd.associated_lead_id = xl.id  then xl.id end) as int) as \"Converted Leads\" \
from   xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery} \
or xl.created_by_company_id=${getCompanyIdByUserIdQuery}


#------------Vendor and Partner / orgadmoin&partner / marketing and partner xamplify login Deal Opportunity Amount-------------
dashboard.VendorandPartnerxamplifyloginDealOpportunityAmount=select sum(xd.amount) \
as \"Opportunity_amount\" \
from \
xt_company_profile xcp \
left join public.xt_deal xd on (xcp.company_id = xd.created_by_company_id ) \
where xd.created_for_company_id = ${getCompanyIdByUserIdQuery} \
or xd.created_by_company_id=  ${getCompanyIdByUserIdQuery}

#--------------------------- OrgAdmin and Partner Contacts to leads ratio xamplify log in------------
dashboard.OrgAdminandPartnerContactstoleadsratio =select concat(round(avg("conversion") ,2) , '%') \"contact to lead\" from \
(select distinct p.campaign_id ,count(distinct xcuul.user_id), count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/ \
  case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign c left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id=xl.associated_user_id \
left join xt_user_profile xup on c.customer_id=xup.user_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.campaign_id is not null \
and p.is_launched = true \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group by 1 \
union \
select distinct  c.campaign_id,count(distinct xcuul.user_id),count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/  \
case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign_user_userlist xcuul \
left join  xt_campaign c on xcuul.campaign_id=c.campaign_id \
 left join xt_lead xl on xcuul.campaign_id=xl.campaign_id  and xcuul.user_id= xl.associated_user_id \
  where c.customer_id in( \
select distinct user_id \
from  xt_user_profile \
where company_id=${getCompanyIdByUserIdQuery})  \
and c.campaign_id is not null \
and c.is_launched = true \
and c.is_channel_campaign =false \
and c.is_nurture_campaign=false \
and c.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group by 1 \
 union \
select distinct p.campaign_id ,count(distinct xcuul.user_id), count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/ \
 case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign c  left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
 left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
 left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id= xl.associated_user_id \
 left join  xt_user_profile xup on p.customer_id=xup.user_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.campaign_id is not null and  p.is_launched = true and p.is_nurture_campaign=true and  p.is_channel_campaign =false \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group by 1)a
 

 #-------------------- Orgadmin and Partner own vanity Leads(Lead to Deal) Conversion-------------
dashboard.OrgadminandPartnerownvanityLeadtoDealConversion =select concat(round((count(distinct xd.id) *1.0/ case when count(distinct xl.id) =0 then 1 \
else count(distinct xl.id) end )*100,2),'%') \
as \"Leads to Deals Conversion %\" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id = xl.created_by_company_id \
left join xt_deal xd on xl.id= xd.associated_lead_id \
where xl.created_for_company_id = ${getCompanyIdByUserIdQuery}	

#--------------orgAdmin and Partner Lead to deal Conversion xamplify login--------------
dashboard.orgAdminandPartnerLeadtodealConversionxamplifylogin=select concat(round(avg("Leads to Deals Conversion %") ,2) , '%') as \"lead todeal\" from \
  (select \
(round((count(distinct xd.id) *1.0/ case when count(distinct xl.id) =0 then 1 \
 else count(distinct xl.id) end )*100,2))  \
as "Leads to Deals Conversion %" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id = xl.created_by_company_id \
left join xt_deal xd on xl.id= xd.associated_lead_id \
where xl.created_for_company_id = ${getCompanyIdByUserIdQuery}	\
union \
select \
(round((count(distinct xd.id) *1.0/ case when count(distinct xl.id) =0 then 1 \
 else count(distinct xl.id) end )*100,2)) \
as \"Leads to Deals Conversion %\" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id = xl.created_by_company_id \
left join xt_deal xd on xl.id= xd.associated_lead_id \
where xl.created_for_company_id != ${getCompanyIdByUserIdQuery} \
and xl.created_by_company_id=${getCompanyIdByUserIdQuery}  )a


#--------for all adminAndPartner roles
#---------------  Latest Lead Created Time  xamplify login------------
dashboard.orgadminandPartnerLatestLeadCreatedTimexamplifylogin=select max(created_time) as \"lead time\" from   xt_lead  \
where created_for_company_id=${getCompanyIdByUserIdQuery} \
or created_by_company_id=${getCompanyIdByUserIdQuery} \

#----------------- Latest Created Time xamplify login-----------
dashboard.MarketingandPartnerDealLatestCreatedTimexamplifylogin =select max(created_time) \"time\" from xt_deal  \
where created_for_company_id= ${getCompanyIdByUserIdQuery} \
or created_by_company_id= ${getCompanyIdByUserIdQuery}

#-------------  Deal Status wise Deals xamplify login-----------
dashboard.OrgAdminandPartnerDealStatuswiseDealsxamplifylogin=select distinct xps.stage_name as \"name\", cast(count(distinct xd.id) as int) as \"value\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id =${getCompanyIdByUserIdQuery} \
or xd.created_by_company_id=${getCompanyIdByUserIdQuery} \
group by 1 \
order by 2 desc

#------------------  xamplify login Leads Status wise Leads-------------
dashboard.OrgAdminandPartnerLeadsStatuswiseDealsxamplifylogin=select distinct xps.stage_name as \"name\", cast(count(distinct xl.id) as int) as \"value\" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id=xl.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_for_company_id = ${getCompanyIdByUserIdQuery} \
or xl.created_by_company_id= ${getCompanyIdByUserIdQuery} \
group by 1 \
order by 2 desc
#---------------------------------------------------------------------------------------
#----------------- OrgAdmin and Partner with Vendor Vanity Login Recipients------------	
dashboard.orgAdminAndPartnerwithVendorVanityLoginRecipients =select cast(count(distinct xcuul.user_id) as int) as \"recipient\" \
from xt_campaign c \
left join xt_campaign p on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on p.campaign_id=xcuul.campaign_id \
 left join xt_user_profile xup on xup.user_id=c.customer_id  \
 left join xt_user_profile xup1 on xup1.user_id=p.customer_id where \
 xup.company_id= :vendorCompanyId \
 and xup1.company_id=:partnerCompanyId	\
 and xcuul.user_id is not null 

 
# ----------------- OrgAdmin and Partner with Vendor Vanity Login Leads------------
dashboard.orgAdminAndPartnerwithVendorVanityLoginLeads=select cast(count(distinct xl.id ) as int) as \"leads\" \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
where xl.created_by_company_id= :partnerCompanyId \
and xl.created_for_company_id= :vendorCompanyId
 

 
 #----------------- OrgAdmin and Partner with vendor Vanity Login Deals------------	
dashboard.orgAdminAndPartnerwithVendorVanityLoginDeals=select cast(count (distinct xd.id ) as int) as \"deals\" \
from  xt_company_profile xcp \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
where xd.created_by_company_id=:partnerCompanyId \
and xd.created_for_company_id=:vendorCompanyId
	
	
#----------------- OrgAdmin and Partner with vendor VanityLogin Won Deals------------		
dashboard.orgAdminAndPartnerwithVendorVanityLoginDealsWon=	select  cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id=:partnerCompanyId \
and xd.created_for_company_id=:vendorCompanyId


#----------------- OrgAdmin and Partner with Vendor Vanity Login contact to lead or marketing & partner vendor vanity------------    
dashboard.OrgAdminandPartnerwithVendorVanityLoginContacttodealconverstion= select concat(round(avg("conversion") ,2) , '%') as  \"converstion\" from \
(select distinct p.campaign_id ,count(distinct xcuul.user_id), count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/ \
  case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign c left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id=xl.associated_user_id \
 left join xt_user_profile xup on xup.user_id=p.customer_id \
     left join xt_user_profile xup1 on xup1.user_id=c.customer_id \
where xup.company_id= :partnerCompanyId \
and xup1.company_id= :vendorCompanyId  \
and p.campaign_id is not null \
and p.is_launched = true \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group  by 1)a


#***********************************************************
#-------------------------Vendor Queries-------------------------
#***************************************************************
#----Recipients for vendor
dashboard.vendorContactsQuery =select cast (count(distinct user_id) as int) as \"contactsCount\" \
from xt_campaign_user_userlist \
where campaign_id in (select p.campaign_id from xt_campaign c left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id where p.is_launched =true and p.campaign_id is not null \
and  c.customer_id in(select distinct  user_id from xt_user_profile where company_id=${getCompanyIdByUserIdQuery})) \
and user_id is not null 


#----vendor contacttolead---------------

dashboard.vendorRoleContactToLeadRatio=select concat(round(avg("conversion") ,2) , '%') as \"ratio\"  from \
(select distinct  p.campaign_id, count(distinct xcuul.user_id), count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/  \
case when count(distinct xcuul.user_id) =0 then 1 \
else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign c  left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id  \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id= xl.associated_user_id \
left join  xt_user_profile xup on c.customer_id=xup.user_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.is_launched = true \
and p.campaign_id is not null \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group by 1)a

#-------------------- Vendor Leads(Lead to Deal) Conversion(or) marketing role also-------------
dashboard.vendorLeadToDealConvertion =select \
concat(round((count(distinct xd.id) *1.0/ case when count(distinct xl.id) =0 then 1 \
 else count(distinct xl.id) end )*100,2),'%')  \
as \"Leads to Deals Conversion %\" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id = xl.created_by_company_id \
left join xt_deal xd on xl.id= xd.associated_lead_id \
where xl.created_for_company_id = ${getCompanyIdByUserIdQuery} \

#----------------- Vendor and Partner with xAmplify Login Recipients ------------     
dashboard.vendorAndPartnerWithXamplifyLogInRecipient = select cast(count(foo) as int) as \"recipient\" from	\
(select distinct user_id \
from xt_campaign_user_userlist where campaign_id in \
(select p.campaign_id from xt_campaign c \
left join xt_campaign p on c.campaign_id=p.parent_campaign_id \
where p.is_launched = true and  c.customer_id in \
(select distinct  user_id from xt_user_profile where company_id=${getCompanyIdByUserIdQuery})) \
 union \
 select distinct  xcuul.user_id \
from    xt_campaign c \
 left join  xt_campaign p on    c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_user_profile xup on xup.user_id=p.customer_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.is_launched = true \
and p.is_nurture_campaign = true)foo

# ----------------- Vendor and Partner with xAmplify Login Leads------------	
dashboard.vendorAndPartnerWithXamplifyLogInLeads=select cast(count (distinct xl.id ) as int) as \"deals\" \
from  xt_company_profile xcp \
left join xt_lead xl on  xl.created_for_company_id=xcp.company_id  \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery} \
	or  xl.created_by_company_id=${getCompanyIdByUserIdQuery}
	

	
#----------------- Vendor and Partner with xAmplify Login Deals------------	
dashboard.vendorAndPartnerWithXamplifyLogInDeals=select cast(count (distinct xd.id ) as int) as \"deals\" \
from  xt_company_profile xcp \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery} \
	 or xd.created_by_company_id=${getCompanyIdByUserIdQuery}
	 
	 
#----------------- Vendor and Partner with xAmplify Login Won Deals------------	
dashboard.vendorAndPartnerWithXamplifyLogInDealsWon=select  cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery} \
	or  xd.created_by_company_id=${getCompanyIdByUserIdQuery}

#------------- Vendor and Partner Xamplify login Contacts to Lead Conversion-----------
dashboard.VendorandPartnerXamplifyloginContactstoLeadConversion=select concat(round(avg("conversion") ,2) , '%')  as \"contact to lead\" from \
(select distinct p.campaign_id ,count(distinct xcuul.user_id), count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/  \
case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign c left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id=xl.associated_user_id \
left join xt_user_profile xup on c.customer_id=xup.user_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.campaign_id is not null \
and p.is_launched = true \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group by 1 \
union \
select distinct p.campaign_id ,count(distinct xcuul.user_id), count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign c  left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id  \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id= xl.associated_user_id \
left join  xt_user_profile xup on p.customer_id=xup.user_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.campaign_id is not null \
and p.is_launched = true \
and p.is_nurture_campaign=true \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group by 1)a

#----------------- Vendor and Partner xamplify login Leads to Deals Conversion-------------
dashboard.VendorandPartnerxamplifyloginLeadstoDealsConversion =select concat(round(avg("Leads to Deals Conversion %") ,2) , '%') as \"lead to deal\" from \
  (select \
(round((count(distinct xd.id) *1.0/ case when count(distinct xl.id) =0 then 1 \
else count(distinct xl.id) end )*100,2)) \
as "Leads to Deals Conversion %" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id = xl.created_by_company_id \
left join xt_deal xd on xl.id= xd.associated_lead_id \
where xl.created_for_company_id = ${getCompanyIdByUserIdQuery}	\
union \
select \
(round((count(distinct xd.id) *1.0/ case when count(distinct xl.id) =0 then 1 \
else count(distinct xl.id) end )*100,2))  \
as "Leads to Deals Conversion %" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id = xl.created_by_company_id \
left join xt_deal xd on xl.id= xd.associated_lead_id \
where xl.created_by_company_id = ${getCompanyIdByUserIdQuery} \
and xl.created_for_company_id != ${getCompanyIdByUserIdQuery} \
)a

#----------------- Vendor and Partner with own Vanity Login Recipients------------
dashboard.vendorAndPartnerWithOwnVanityLogInRecipients=select cast(count(distinct xcuul.user_id) as int) as \"recipient\" \
from xt_campaign c left join xt_campaign p on c.campaign_id=p.parent_campaign_id \
 left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
 left join xt_user_profile xup on xup.user_id=c.customer_id \
 where xup.company_id=${getCompanyIdByUserIdQuery} \
 and p.is_launched = true \
 and xcuul.user_id is not null

 #----------------- Vendor and Partner with Vendor Vanity Login Recipients------------	
dashboard.vendorAndPartnerWithVendorVantityLogInRecipients=select cast( count(distinct xcuul.user_id)  as int) as \"recipients\" \
from xt_campaign c left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
 left join xt_user_profile xup on xup.user_id=p.customer_id \
     left join xt_user_profile xup1 on xup1.user_id=c.customer_id \
where xup.company_id=:partnerCompanyId \
and xup1.company_id=:vendorCompanyId \
and c.is_launched=true	\
and xcuul.user_id is not null 

#----------------- Vendor and Partner with Vendor Vanity Login Leads------------
dashboard.vendorAndPartnerWithVendorVantityLogInLeads=select cast(count(distinct xl.id ) as int) \"leads\" \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_by_company_id =xcp.company_id \
where xl.created_by_company_id=:partnerCompanyId \
	and xl.created_for_company_id=:vendorCompanyId
	
	
#----------------- Vendor and Partner with vendor Vanity Login Deals------------
dashboard.vendorAndPartnerWithVendorVantityLogInDeals=select cast(count (distinct xd.id ) as int) as \"deals\" \
from  xt_company_profile xcp \
left join xt_deal xd on  xd.created_by_company_id=xcp.company_id \
where xd.created_by_company_id=:partnerCompanyId \
	and xd.created_for_company_id=:vendorCompanyId
	
#----------------- Vendor and Partner with vendor VanityLogin Won Deals------------
dashboard.vendorAndPartnerWithVendorVantityLogInDealsWon=select  cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id=:partnerCompanyId \
	and xd.created_for_company_id=:vendorCompanyId	 


#leads
#-----------------
dashboard.vendorLeadsQueryForOwnVanityLogin=select cast(count(distinct xl.id ) as int) as \"leadsCount\" \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery}



dashboard.partnerLeadsQuery=select  cast(count(distinct xl.id) as int) as  \"leadsCount\" \
from  xt_lead xl \
left join xt_pipeline_stage xps1 on xl.pipeline_stage_id =xps1.id \
left join xt_user_profile xup on xup.user_id=xl.created_by \
left join xt_company_profile xcp1 on xup.company_id=xcp1.company_id \
where xl.created_by_company_id =${getCompanyIdByUserIdQuery} \
and xl.created_for_company_id!=${getCompanyIdByUserIdQuery}
 
 #Deals
 -------

dashboard.dealCreatedForCompanyIdQuery= where xd.created_for_company_id=${getCompanyIdByUserIdQuery} \


dashboard.vendorDealsForOwnVanityLogin=select cast(count (distinct xd.id ) as int) as \"deals\" \
from  xt_company_profile xcp \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery}

dashboard.partnerDealsQuery=select cast(count(distinct xd.id ) as int) as \"deals\" \
from xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
where xd.created_by_company_id =${getCompanyIdByUserIdQuery} \
and xd.created_for_company_id!=${getCompanyIdByUserIdQuery}
  

#Deals Won
------------------

dashboard.vendorDealsWonForOwnVanityLogin=select cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery} 




#PIE CHARTS QUERIES
---------------------------------------------------------------------



#Partner Pie chart
-----------------------------
#Leads
----------

dashboard.partnerLeadWhereCondition= where xl.created_by_company_id=${getCompanyIdByUserIdQuery} and xl.created_for_company_id!=${getCompanyIdByUserIdQuery}

#---------Partner Deals Pie-------------
#Partner deals
--------------------
dashboard.partnerDealWhereCondition= where xd.created_by_company_id=${getCompanyIdByUserIdQuery} and xd.created_for_company_id!=${getCompanyIdByUserIdQuery} \


#-------------------- Vendor Leads(Lead to Deal) Conversion-------------
dashboard.vendorLeadToDealQueryForOwnVanityLoginOfPieChart=select \
concat(round((count(distinct xd.id) *1.0/ case when count(distinct xl.id) =0 then 1 \
 else count(distinct xl.id) end )*100,2),'%') \
as \"Leads to Deals Conversion %\" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id = xl.created_by_company_id \
left join xt_deal xd on xl.id= xd.associated_lead_id \

dashboard.vendorLeadToDealConversionPieChart =${dashboard.vendorLeadToDealQueryForOwnVanityLoginOfPieChart} where xl.created_for_company_id = ${getCompanyIdByUserIdQuery} \

dashboard.vendorLeadToDealQueryForVendorVanityLoginOfPieChart=${dashboard.vendorLeadToDealQueryForOwnVanityLoginOfPieChart} ${dashboard.partnerVanityLoginWhereCondition}










#------------ Vendor Lead Won Pie chart for teammember----------
dashboard.leadWonQueryForVedorTeamMemberOfPieChart=select cast(count (distinct case when xps.is_won = true then xl.id end) as int) as \"Won Leads\" \
from   xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_by_company_id in( \
select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId and p.partner_id is not null) and xl.created_for_company_id=${getCompanyIdByUserIdQuery}
	
#------------ Vendor Lead Lost Pie chart for teammember----------
dashboard.leadLostQueryForVedorTeamMemberOfPieChart=select \
cast(count(distinct case when xps.is_lost= true then xl.id end ) as int) as \"Lost Leads\" \
from   xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_by_company_id in( \
select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId and p.partner_id is not null) and xl.created_for_company_id=${getCompanyIdByUserIdQuery}

#------------ Vendor Lead Converted Pie chart for teammember----------
dashboard.leadCovertedQueryForVedorTeamMemberOfPieChart=select \
cast(count(distinct case when xd.associated_lead_id = xl.id  then xl.id end) as int) as \"Converted Leads\" \
from   xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_by_company_id in( \
select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId and p.partner_id is not null) and xl.created_for_company_id=${getCompanyIdByUserIdQuery}

	
#------------ Vendor Deals won Pie chart for team member----------
dashboard.dealWonQueryForVedorTeamMemberOfPieChart=select \
cast(count (distinct case when xps.is_won = true then xd.id end) as int) as \"Won deals\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where  xd.created_by_company_id in( \
select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId and p.partner_id is not null) and xd.created_for_company_id=${getCompanyIdByUserIdQuery}

	
#------------ Vendor Deals Lost Pie chart----------
dashboard.dealLostQueryForVedorTeamMemberOfPieChart=select \
cast(count(distinct case when xps.is_lost= true then xd.id end ) as int) as \"Lost Deals\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where  xd.created_by_company_id in( \
select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId and p.partner_id is not null) and xd.created_for_company_id=${getCompanyIdByUserIdQuery}

	
#------------- Vendor Deal Status wise Deals for teammember-----------
dashboard.vendorStatusWiseDealForTeamMember=select distinct xps.stage_name as \"name\", cast(count(distinct xd.id) as int) as \"value\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id in( \
select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId \
	and p.partner_id is not null) and xd.created_for_company_id=${getCompanyIdByUserIdQuery} \
group by 1 \
order by 2 desc
	 
#New Queries---------------------------------------------------------------------

#---------------------------- Marketing role Recipients--------------
 dashboard.marketingRoleRecipientsOfFunnelChart=select cast(count(distinct user_id) as int) as \"recipients\" \
from xt_campaign_user_userlist where  campaign_id in \
 (select distinct campaign_id from xt_campaign where is_launched =true and campaign_id is not null and customer_id in( \
select distinct user_id \
from  xt_user_profile \
where company_id=${getCompanyIdByUserIdQuery}))

# ---------------------------- Marketing role Leads--------------
dashboard.marketingRoleLeadsOfFunnelChart=select cast(count(distinct xl.id ) as int) as \"leads\" \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery}
 
#---------------------------- Marketing role Deals-------------- 
dashboard.marketingRoleDealsOfFunnelChart=select cast(count (distinct xd.id ) as int) as \"deals\" \
from  xt_company_profile xcp \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery}
 
#---------------------------- Marketing role Won Deals--------------
dashboard.marketingRoleDealsWonOfFunnelChart=select cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery}

#---------------------- Marketing role contacts to leads conversion--------------
dashboard.Marketingrolecontactstoleadsconversion=select concat(round(avg("conversion") ,2) , '%')  as \"ratio\" from \
(select distinct c.campaign_id ,count(distinct xcuul.user_id), count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign c left join xt_campaign_user_userlist xcuul \
on c.campaign_id=xcuul.campaign_id \
left join xt_lead xl on xl.campaign_id=xcuul.campaign_id and xl.associated_user_id=xcuul.user_id \
left join xt_user_profile xup on xup.user_id=c.customer_id \
where xup.company_id= ${getCompanyIdByUserIdQuery} \
and c.campaign_id is not null \
and c.is_launched = true \
and c.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group by 1)a

#----------------- Marketing and Partner with xAmplify Login Recipients ------------	 
dashboard.marketingAndPartnerwithxAmplifyLoginRecipients=select cast(count(foo) as int) as \"recipient\" from \
 (select distinct user_id \
from xt_campaign_user_userlist \
where campaign_id in \
 (select distinct campaign_id \
 from xt_campaign \
where is_launched= true \
  and is_channel_campaign=false \
  and is_nurture_campaign=false \
and customer_id in( \
select distinct user_id \
from  xt_user_profile \
where company_id=${getCompanyIdByUserIdQuery})) \
	 union  \
select distinct  xcuul.user_id \
from xt_campaign c \
left join  xt_campaign p on  c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_user_profile xup on xup.user_id=p.customer_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.is_launched = true \
and p.campaign_id is not null and p.is_nurture_campaign =true)foo
	   
#--------------------- Marketing and Partner xamplify login contacts to leads conversion------------------

dashboard.marketingandPartnerxamplifylogincontactstoleadsconversion=select concat(round(avg("conversion") ,2) , '%') as \"count\" from \
(select distinct  c.campaign_id,count(distinct xcuul.user_id),count(distinct xl.id),\
(round((count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign_user_userlist xcuul \
left join  xt_campaign c on xcuul.campaign_id=c.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id  and xcuul.user_id= xl.associated_user_id \
where is_channel_campaign=false \
 and is_nurture_campaign=false \
 and c.is_launched =true and c.campaign_id is not null and c.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') and xcuul.user_id is not null and \
 c.customer_id in( \
select distinct user_id \
from  xt_user_profile \
where company_id=${getCompanyIdByUserIdQuery}) \
group by 1 \
union \
select distinct  p.campaign_id,count(distinct xcuul.user_id),count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
 from \
xt_campaign c left join  xt_campaign p on \
c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xl.campaign_id=xcuul.campaign_id and xcuul.user_id=xl.associated_user_id \
left join xt_user_profile xup on xup.user_id=p.customer_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.campaign_id is not null and p.is_nurture_campaign =true  and p.is_launched =true and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') and xcuul.user_id is not null \
group by 1)a

#----------------- Marketing and Partner with xAmplify Login Leads------------	
dashboard.marketingAndPartnerwithxAmplifyLoginLeads=select cast(count (distinct xl.id )  as int) as \"leads\" \
from  xt_company_profile xcp \
left join xt_lead xl on  xl.created_for_company_id=xcp.company_id \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery} \
	or  xl.created_by_company_id=${getCompanyIdByUserIdQuery}

	   
#----------------- Marketing and Partner with xAmplify Login Deals------------	
dashboard.marketingAndPartnerwithxAmplifyLoginDeals=select cast(count (distinct xd.id ) as int) as \"deals\" \
from  xt_company_profile xcp \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery} \
	 or xd.created_by_company_id=${getCompanyIdByUserIdQuery}

#----------------- Marketing and Partner with xAmplify Login Won Deals------------
dashboard.marketingAndPartnerwithxAmplifyLoginDealsWon=select cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery} \
or  xd.created_by_company_id=${getCompanyIdByUserIdQuery}	   

#----------------- Marketing and Partner with own Vanity Login Recipients------------
dashboard.MarketingandPartnerwithownVanityLoginRecipients =select cast(count(foo) as int) as \"count\" from \
(select distinct user_id \
from xt_campaign_user_userlist where campaign_id in \
 (select distinct campaign_id from xt_campaign \
where is_launched= true \
  and is_channel_campaign=false \
  and is_nurture_campaign=false \
  and campaign_id is not null \
and customer_id in( \
select distinct user_id \
from  xt_user_profile \
where company_id=${getCompanyIdByUserIdQuery})) ) as foo 
	
	
#----------------- Marketing and Partner with own Vanity Login Leads------------
dashboard.MarketingandPartnerwithownVanityLoginLeads=select cast(count(distinct xl.id ) as int) as \"leads\" \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery}
	
	
#----------------- Marketing and Partner with own Vanity Login Deals------------
dashboard.MarketingandPartnerwithownVanityLoginDeals=select cast(count (distinct xd.id ) as int) as \"deals\" \
from  xt_company_profile xcp \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery}
	
#----------------- Marketing and Partner with own VanityLogin Won Deals------------
dashboard.MarketingandPartnerwithownVanityLoginDealsWon	=select cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery}




#---------Marketing and Partner ---------own vanity login----------- contacts to leads conversion------------
#Average of (Converted leads/To Recipients for each campaign) * 100


#--------------------------------------------------------------------------------------------------
dashboard.marketingandPartnerOwnVanityContacttoleadratio=select concat(round(avg("conversion") ,2) , '%') \"ratio\" from \
(select distinct  c.campaign_id,count(distinct xcuul.user_id),count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end )*100,2)) "conversion"\
from xt_campaign_user_userlist xcuul \
left join  xt_campaign c on xcuul.campaign_id=c.campaign_id \
 left join xt_lead xl on xcuul.campaign_id=xl.campaign_id  and xcuul.user_id= xl.associated_user_id \
  where is_channel_campaign=false \
 and is_nurture_campaign=false \
and c.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
and c.customer_id in( \
select distinct user_id \
from  xt_user_profile \
where company_id=${getCompanyIdByUserIdQuery}) \
group by 1)a


#----------------- Marketing and Partner with Vendor Vanity Login Recipients------------    
dashboard.marketingandPartnerwithVendorVanityLoginRecipients=select cast( count(distinct xcuul.user_id)  as int) as \"Recipients\" \
from xt_campaign c left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_user_profile xup on xup.user_id=p.customer_id \
left join xt_user_profile xup1 on xup1.user_id=c.customer_id \
where xup.company_id= :partnerCompanyId \
and xup1.company_id= :vendorCompanyId \
and p.is_launched = true and p.campaign_id is not null \
and p.is_nurture_campaign =true

#----------------- Marketing and Partner with Vendor Vanity Login Leads------------
dashboard.marketingandPartnerwithVendorVanityLoginLeads=select cast(count(distinct xl.id ) as int) as \"leads\" \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_by_company_id =xcp.company_id \
where xl.created_by_company_id=:partnerCompanyId \
	and xl.created_for_company_id=:vendorCompanyId

#----------------- Marketing and Partner with vendor Vanity Login Deals------------
dashboard.marketingandPartnerwithVendorVanityLoginDeals=select cast(count (distinct xd.id ) as int) as \"deals\" \
from  xt_company_profile xcp \
left join xt_deal xd on  xd.created_by_company_id=xcp.company_id \
where xd.created_by_company_id=:partnerCompanyId \
	and xd.created_for_company_id=:vendorCompanyId
	
#----------------- Marketing and Partner with vendor VanityLogin Won Deals------------
dashboard.marketingandPartnerwithVendorVanityLoginDealsWon=select  cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id=:partnerCompanyId \
	and xd.created_for_company_id=:vendorCompanyId
	
	
#---------------- prm Leads---------------------------
dashboard.prmLeadsOfFunelChart=select cast(count(distinct xl.id ) as int) as \"ledas\" \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery}

#-------------prm Deals-------------------------------
dashboard.prmDealsOfFunelChart=select cast(count (distinct xd.id ) as int) as \"deals\" \
from  xt_company_profile xcp \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery}

#-------------prm Deal Won--------------------------
dashboard.prmDealsWonOfFunelChart=select cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery}

#------------Prm And Partner with If parntership established With vendor/orgadmin Recipients (xamplify login)---------------------------------------------
dashboard.prmAndPartnerwithIfparntershipestablishedWithvendorOrorgadminRecipientsofXamplifyLogin=select cast(count(distinct user_id) as int) as \"recipients\" \
from xt_campaign_user_userlist \
where campaign_id in \
 (select distinct p.campaign_id from xt_campaign c \
 left join xt_campaign p on c.campaign_id=p.parent_campaign_id \
where p.customer_id in (select distinct user_id from xt_user_profile where company_id=${getCompanyIdByUserIdQuery}) \
and p.is_launched=true \
and p.is_nurture_campaign =true \
and p.campaign_id is not null) \


#-----------------Prm And Partner with If parntership established With vendor/orgadmin Leads (xamplify login)---------------------------------------------
dashboard.prmAndPartnerwithIfparntershipestablishedWithvendorOrorgadminLeadsofXamplifyLogin=select cast(count(distinct xl.id) as int) as \"lead\" \
from  xt_lead xl \
left join xt_pipeline_stage xps1 on xl.pipeline_stage_id =xps1.id \
where xl.created_by_company_id =${getCompanyIdByUserIdQuery} \
or xl.created_for_company_id =${getCompanyIdByUserIdQuery}


#-----------------Prm And Partner with If parntership established With vendor/orgadmin  Deals (xamplify login)---------------------------------------------
dashboard.prmAndPartnerwithIfparntershipestablishedWithvendorOrorgadminDealsofXamplifyLogin=select cast(count(distinct xd.id) as int) as \"deals\" \
from  xt_deal xd \
left join xt_pipeline_stage xps1 on xd.pipeline_stage_id =xps1.id \
where xd.created_by_company_id =${getCompanyIdByUserIdQuery} \
or xd.created_for_company_id =${getCompanyIdByUserIdQuery}

#-----------------Prm And Partner with If parntership established With vendor/orgadmin Won Deals (xamplify login) ---------------------------------------------
dashboard.prmAndPartnerwithIfparntershipestablishedWithvendorOrorgadminDealsWonofXamplifyLogin=select cast( count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from \
xt_deal xd \
inner join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id =${getCompanyIdByUserIdQuery} \
or xd.created_for_company_id =${getCompanyIdByUserIdQuery}	


#-----------Prm And Partner with If parntership established With vendor/orgadmin contacts to leads conversion(xamplify login)---------------------------------------------
#Average of 

#(Converted leads/ Redistributed contacts for each campaign) * 100
#------------------------------------------------------------------------------------------------------------------

dashboard.prmAndPartnerwithIfparntershipestablishedWithvendorOrorgadminContactToLeadRatioofXamplifyLogin=select concat(round(avg("conversion") ,2) , '%')  as \"ratio\" from \
(select distinct  p.campaign_id,count(distinct xcuul.user_id),count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from \
xt_campaign c left join  xt_campaign p on \
c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xl.campaign_id=xcuul.campaign_id and xcuul.user_id=xl.associated_user_id \
left join xt_user_profile xup on xup.user_id=p.customer_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group by 1)a

#----------------- Prm And Partner with If parntership established With vendor/orgadmin Leads (own vanity login) ---------------------------------------------
dashboard.prmAndPartnerwithIfparntershipestablishedWithvendorOrorgadminLeadsofOwnvanityLogin=select cast(count(distinct xl.id) as int) as \"leads\" \
from  xt_lead xl \
left join xt_pipeline_stage xps1 on xl.pipeline_stage_id =xps1.id \
where xl.created_for_company_id=${getCompanyIdByUserIdQuery}


#------------------- Prm And Partner with If parntership established With vendor/orgadmin Deals (own vanity login)----------------------------------------------
dashboard.prmAndPartnerwithIfparntershipestablishedWithvendorOrorgadminDealsofOwnvanityLogin=select cast(count(distinct xd.id ) as int) as \"deals\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
where xd.created_for_company_id=${getCompanyIdByUserIdQuery}


#----------------- Prm And Partner with If parntership established With vendor/orgadmin Won Deals (own vanity login)------------------------------------------------------
dashboard.prmAndPartnerwithIfparntershipestablishedWithvendorOrorgadminDealsWonofOwnvanityLogin=select cast( count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from \
xt_deal xd  \
inner join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id =${getCompanyIdByUserIdQuery} \	


#------------Prm And Partner with If parntership established With vendor/orgadmin Recipients (Vendor vanity login) ---------------------------------------------
dashboard.prmAndPartnerPartnershipEstablishedWithVendorOrOrgAdminRecipientVendorVanity=select cast(count(distinct xcuul.user_id) as int) as \"count\" \
from xt_campaign_user_userlist xcuul \
left join xt_campaign p  on xcuul.campaign_id = p.campaign_id \
left join xt_campaign c on c.campaign_id=p.parent_campaign_id \
 left join xt_user_profile xup on xup.user_id=p.customer_id \
 left join xt_user_profile xup1 on xup1.user_id=c.customer_id \
 where xup.company_id=:partnerCompanyId \
and xup1.company_id=:vendorCompanyId \
and p.campaign_id is not null \
and p.is_launched=true \
and p.is_nurture_campaign =true


	

#----------------- Prm And Partner with If parntership established With vendor/orgadmin leads (Vendor vanity login) ---------------------------------------------
dashboard.prmAndPartnerPartnershipEstablishedWithVendorOrOrgAdminLeadsVendorVanity=select cast(count(distinct xl.id) as int) as \"leads\" \
from  xt_lead xl \
left join xt_pipeline_stage xps1 on xl.pipeline_stage_id =xps1.id \
where xl.created_by_company_id =:partnerCompanyId \
and xl.created_for_company_id=:vendorCompanyId

															 
#------------------- Prm And Partner with If parntership established With vendor/orgadmin Deals (Vendor vanity login)----------------------------------------------
dashboard.prmAndPartnerPartnershipEstablishedWithVendorOrOrgAdminDealsVendorVanity=select cast(count(distinct xd.id ) as int) as\"deals\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
where xd.created_by_company_id =:partnerCompanyId \
and xd.created_for_company_id=:vendorCompanyId


#-----------------Prm And Partner with If parntership established With vendor/orgadmin Won Deals (Vendor vanity login)------------------------------------------------------
dashboard.prmAndPartnerPartnershipEstablishedWithVendorOrOrgAdminDealswonVendorVanity=select cast( count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from \
xt_deal xd \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id =:partnerCompanyId \
and xd.created_for_company_id =:vendorCompanyId



#-----------------PRM & Partner (If parntership establishedWith PRM) Leads (xamplify login)---------------------------------------------
dashboard.PartnerPartnershipWithPrmXamplifyLoginllead=select cast(count(distinct xl.id) as int) as \"leads\" \
from  xt_lead xl \
left join xt_pipeline_stage xps1 on xl.pipeline_stage_id =xps1.id \
where xl.created_by_company_id =${getCompanyIdByUserIdQuery} \
or xl.created_for_company_id =${getCompanyIdByUserIdQuery}


#-----------------PRM & Partner (If parntership establishedWith PRM)  Deals (xamplify login)---------------------------------------------
dashboard.PartnerPartnershipWithPrmXamplifyLoginDeal=select cast(count(distinct xd.id) as int) as \"deals\" \
from  xt_deal xd \
left join xt_pipeline_stage xps1 on xd.pipeline_stage_id =xps1.id \
where xd.created_by_company_id =${getCompanyIdByUserIdQuery} \
or xd.created_for_company_id =${getCompanyIdByUserIdQuery}

#-----------------PRM & Partner (If parntership establishedWith PRM) Won Deals (xamplify login) ---------------------------------------------
dashboard.PartnerPartnershipWithPrmXamplifyLoginlDealWon=select cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealWon\" \
from \
xt_deal xd \
inner join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id =${getCompanyIdByUserIdQuery} \
or xd.created_for_company_id =${getCompanyIdByUserIdQuery}	


#----------------- PRM & Partner (If parntership establishedWith PRM) Leads (own vanity login) ---------------------------------------------
dashboard.prmAndPartnerEstablishedWithPrmOwnVanityLoginleads=select cast(count(distinct xl.id) as int) as \"leads\" \
from  xt_lead xl \
left join xt_pipeline_stage xps1 on xl.pipeline_stage_id =xps1.id \
where xl.created_for_company_id =${getCompanyIdByUserIdQuery}


#------------------- PRM & Partner (If parntership establishedWith PRM) Deals (own vanity login)----------------------------------------------
dashboard.prmAndPartnerEstablishedWithPrmOwnVanityLoginDeals=select cast(count(distinct xd.id ) as int) as \"deals\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
where xd.created_for_company_id =${getCompanyIdByUserIdQuery}


#----------------- PRM & Partner (If parntership establishedWith PRM) Won Deals (own vanity login)------------------------------------------------------
dashboard.prmAndPartnerEstablishedWithPrmOwnVanityLoginDealsWon=select cast( count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from \
xt_deal xd \
inner join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id =${getCompanyIdByUserIdQuery}	


#----------------- PRM & Partner (If parntership establishedWith PRM) leads (Vendor vanity login) ---------------------------------------------
dashboard.prmAndPartnerEstablishedWithPrmVendorVanityLoginLeads=select cast(count(distinct xl.id) as int) as \"leads\" \
from  xt_lead xl \
left join xt_pipeline_stage xps1 on xl.pipeline_stage_id =xps1.id \
where xl.created_by_company_id =:partnerCompanyId \
and xl.created_for_company_id=:vendorCompanyId

															 
#------------------- PRM & Partner (If parntership establishedWith PRM) Deals (Vendor vanity login)----------------------------------------------
dashboard.prmAndPartnerEstablishedWithPrmVendorVanityLoginDeals=select cast(count(distinct xd.id ) as int) as \"deals\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
where xd.created_by_company_id =:partnerCompanyId \
and xd.created_for_company_id=:vendorCompanyId


#-----------------PRM & Partner (If parntership establishedWith PRM) Won Deals (Vendor vanity login)------------------------------------------------------
dashboard.prmAndPartnerEstablishedWithPrmVendorVanityLoginDealsWon=select cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from \
xt_deal xd \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id = :partnerCompanyId \
and xd.created_for_company_id = :vendorCompanyId

#------------Partner Query ---------------------------------------------

#--------------------------Recipients--------------------------------------------------------------------
dashboard.partnerContactsQuery=select cast(count(distinct  xcuul.user_id) as int) as \"recipients\" \
from \
xt_campaign c left join  xt_campaign p on \
c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_user_profile xup on xup.user_id=p.customer_id \
where xup.company_id= ${getCompanyIdByUserIdQuery} \
and p.is_launched =true and p.campaign_id is not null \
 and p.is_nurture_campaign=true
 
 #--------------Leads--------------
dashboard.funnelPartnerLeadsQuery=select cast(count(distinct xl.id) as int) as \"leads\" \
from  xt_lead xl \
left join xt_pipeline_stage xps1 on xl.pipeline_stage_id =xps1.id \
where xl.created_by_company_id = ${getCompanyIdByUserIdQuery} \
and xl.created_for_company_id!= ${getCompanyIdByUserIdQuery}




#------------------ Partner Leads pie chart--------------


dashboard.partnerXamplifyLogInLeadWon=select cast(count (distinct case when xps.is_won = true then xl.id end) as int) as \"Won Leads\" \
from   xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id   \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_by_company_id=${getCompanyIdByUserIdQuery} \
and xl.created_for_company_id!=${getCompanyIdByUserIdQuery}



		
dashboard.partnerXamplifyLogInLeadsLost=select cast(count(distinct case when xps.is_lost= true then xl.id end )  as int)as \"Lost Leads\" \
from   xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id   \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_by_company_id=${getCompanyIdByUserIdQuery} \
and xl.created_for_company_id!=${getCompanyIdByUserIdQuery}
		
		
dashboard.partnerXamplifyLogInLeadsConvertd=select cast( count(distinct case when xd.associated_lead_id = xl.id  then xl.id end) as int) as \"Converted Leads\" \
from   xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id   \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_by_company_id=${getCompanyIdByUserIdQuery} \
and xl.created_for_company_id!=${getCompanyIdByUserIdQuery}
		
		


#Partner Deals Lost
--------------------
dashboard.partnerDealLostQueryForOwnVanityLoginOfPieChart=select \
cast(count(distinct case when xps.is_lost= true then xd.id end ) as int) as \"Lost Deals\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \

dashboard.partnerPieDealsLostQuery=${dashboard.partnerDealLostQueryForOwnVanityLoginOfPieChart} ${dashboard.partnerDealWhereCondition} \

#partner Deals Won
-------------------------------
dashboard.partnerDealWonQueryForOwnVanityLoginOfPieChart=select \
cast(count (distinct case when xps.is_won = true then xd.id end) as int) as \"Won Deals\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \


dashboard.partnerPieDealsWonQuery= ${dashboard.partnerDealWonQueryForOwnVanityLoginOfPieChart} ${dashboard.partnerDealWhereCondition} \

 
#-------------Partner Latest Lead Created Time----------------

dashboard.partnerLatestLeadCreatedTimeQueryForOwnVanityLoginOfPieChart= select \
 max(created_time) as \"Latest Lead Created Time\" from   xt_lead \
 
dashboard.partnerLatestLeadCreatedTimeOfPieChart= ${dashboard.partnerLatestLeadCreatedTimeQueryForOwnVanityLoginOfPieChart} where created_by_company_id=${getCompanyIdByUserIdQuery} and created_for_company_id!=${getCompanyIdByUserIdQuery} \


#----------Partner Latest Deal created Time------------
dashboard.partnerLatestDealCreatedTimeQueryForOwnVanityLoginOfPieChart=select \
max(created_time) as \"Latest Deal Created Time\" from xt_deal \

dashboard.partnerLatestDealCreatedTimeOfPieChart= ${dashboard.partnerLatestDealCreatedTimeQueryForOwnVanityLoginOfPieChart} where created_by_company_id=${getCompanyIdByUserIdQuery} and created_for_company_id!=${getCompanyIdByUserIdQuery} \

dashboard.partnerLatestDealCreatedTimeQueryForPartnerVanityLoginOfPieChart= ${dashboard.partnerLatestDealCreatedTimeQueryForOwnVanityLoginOfPieChart} where created_for_company_id = :vendorCompanyId and created_by_company_id = :partnerCompanyId


#------------- Partner Deal Status wise Deals-----------
dashboard.partnerStatuswiseDealQueryForOwnVanityLoginOfPieChart=select distinct xps.stage_name as \"name\", cast(count(distinct xd.id) as int) as \"value\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
 
dashboard.partnerStatusWiseDealsOfPiehart= ${dashboard.partnerStatuswiseDealQueryForOwnVanityLoginOfPieChart} where xd.created_by_company_id =${getCompanyIdByUserIdQuery} and xd.created_for_company_id !=${getCompanyIdByUserIdQuery} group by 1 order by 2 desc \


#------------------ partner Leads Status wise Leads-------------
dashboard.partnerStatuswiseLeadQueryForOwnVanityLoginOfPieChart=select distinct xps.stage_name as \"name\", cast(count(distinct xl.id) as int) as \"value\" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id=xl.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \

dashboard.partnerStatusWiseLeadsOfPieChart= ${dashboard.partnerStatuswiseLeadQueryForOwnVanityLoginOfPieChart} where xl.created_by_company_id =${getCompanyIdByUserIdQuery} and xl.created_for_company_id !=${getCompanyIdByUserIdQuery} \
group by 1 order by 2 desc \



#-------------------------------Partner Deal Opportunity Amount--------------
dashboard.partnerDealOpportunityQueryForOwnVanityLoginOfPieChart=select sum(xd.amount) \
as \"Opportunity_amount\"  \
from \
xt_company_profile xcp \
left join public.xt_deal xd on (xcp.company_id = xd.created_by_company_id ) \

dashboard.partnerDealOpportunityAmountOfPieChart=${dashboard.partnerDealOpportunityQueryForOwnVanityLoginOfPieChart} where xd.created_by_company_id = ${getCompanyIdByUserIdQuery} \
and xd.created_for_company_id != ${getCompanyIdByUserIdQuery}

dashboard.patnerDealOpportunityAmountQueryForPartnerVanityLoginOfPieChart=${dashboard.partnerDealOpportunityQueryForOwnVanityLoginOfPieChart} where xd.created_for_company_id = :vendorCompanyId and xd.created_by_company_id = :partnerCompanyId \

#------------- Partner Contacts to Leads Conversion-------------
dashboard.partnerContactToLeadConversionForPieChart=select concat(round(avg("conversion") ,2) , '%') as \"ratio\" from \
( \
select distinct  p.campaign_id,count(distinct xcuul.user_id),count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/  \
case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from \
xt_campaign c left join  xt_campaign p on  \
c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xl.campaign_id=xcuul.campaign_id and xcuul.user_id=xl.associated_user_id \
left join xt_user_profile xup on xup.user_id=p.customer_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.campaign_id is not null \
and p.is_launched = true \
and p.is_nurture_campaign =true \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group by 1)a 

#------------Only Partner Vendor vanity Login Contacts to leads--------

dashboard.partnerVendorVanityForContacttoLeadcoversion=select concat(round(avg("conversion") ,2) , '%') \"ratio\" from \
(select distinct p.campaign_id ,count(distinct xcuul.user_id), count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign c left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id=xl.associated_user_id \
 left join xt_user_profile xup on xup.user_id=p.customer_id \
     left join xt_user_profile xup1 on xup1.user_id=c.customer_id \
where xup.company_id= :partnerCompanyId \
and xup1.company_id= :vendorCompanyId \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group  by 1)a

#----------------- Partner Leads to Deals Conversion-------------
dashboard.createdByCompanyIdOfPieChart= and xl.created_by_company_id=${getCompanyIdByUserIdQuery} \

dashboard.partnerLeadToDealQueryForOwnVanityLoginOfPieChart=select \
concat(round((cast (count(distinct xd.id ) as decimal) / \
case when cast(count(distinct xl.id) as decimal) = 0 then 1 else cast (count(distinct xl.id) as decimal) end)*100,2),'%') \
as \"Leads to Deals Conversion %\" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id = xl.created_by_company_id \
left join xt_deal xd on xl.id= xd.associated_lead_id  \



dashboard.partnerLeadToDealConversionForPieChart= ${dashboard.partnerLeadToDealQueryForOwnVanityLoginOfPieChart} where xl.created_by_company_id = ${getCompanyIdByUserIdQuery} and xl.created_for_company_id!=${getCompanyIdByUserIdQuery} 

dashboard.patnerLeadToDealQueryForPartnerVanityLoginOfPieChart=${dashboard.partnerLeadToDealQueryForOwnVanityLoginOfPieChart} ${dashboard.partnerVanityLoginWhereCondition} \

 

dashboard.partnerRecipientVendorVanityLogin=select cast(count(distinct  xcuul.user_id) as int) as \"recipients\" \
from \
xt_campaign c left join  xt_campaign p on  \
c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_user_profile xup on xup.user_id=p.customer_id \
left join xt_user_profile xup1 on xup1.user_id=c.customer_id \
where xup.company_id= :partnerCompanyId \
and xup1.company_id= :vendorCompanyId \
and p.is_launched =true \
and p.campaign_id is not null \
and p.is_nurture_campaign =true

#------------------- Partner Deals----------------------------------------------
dashboard.partnerDealsForXamplifyLogIn=select cast(count(distinct xd.id ) as int) as \"deals\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
where xd.created_by_company_id =${getCompanyIdByUserIdQuery} \
and xd.created_for_company_id!=${getCompanyIdByUserIdQuery}

#---deals won 
dashboard.partnerDealsWon=select cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" from \
xt_deal xd inner join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id =${getCompanyIdByUserIdQuery} \
and xd.created_for_company_id !=${getCompanyIdByUserIdQuery} 
 
 
 
 #----------------- Vanity Login Partner Leads funnel---------------------------------------------
dashboard.partnerLeadsQueryForOwnVanityLogin=select cast(count(distinct xl.id) as int) as \"leadsCount\" \
from  xt_lead xl \
left join xt_pipeline_stage xps1 on xl.pipeline_stage_id =xps1.id \


dashboard.partnerVanityLoginWhereCondition=  where xl.created_for_company_id = :vendorCompanyId and xl.created_by_company_id = :partnerCompanyId


dashboard.leadQueryForPartnerVanityLogin= ${dashboard.partnerLeadsQueryForOwnVanityLogin} ${dashboard.partnerVanityLoginWhereCondition} \


#------------------- Vanity Login Partner Deals funnel ----------------------------------------------
dashboard.partnerDealsQueryForOwnVanityLogin=select cast(count(distinct xd.id )as int) as \"dealsCount\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \


dashboard.partnerDealVanityLoginWhereCondition=  where xd.created_for_company_id = :vendorCompanyId and xd.created_by_company_id = :partnerCompanyId


dashboard.dealsQueryForPartnerVanityLogin= ${dashboard.partnerDealsQueryForOwnVanityLogin} ${dashboard.partnerDealVanityLoginWhereCondition} \


#-----------------Vanity Login Deals Won funnel------------------------------------------------------
dashboard.partnerDealsWonQueryForOwnVanityLogin=select cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealsWon\" \
from \
xt_deal xd \
inner join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id\


dashboard.dealWonsQueryForPartnerVanityLogin=${dashboard.partnerDealsWonQueryForOwnVanityLogin} ${dashboard.partnerDealVanityLoginWhereCondition} \







#------------------------Teammembers Queries---------------------------
#----------------------  Team Member Recipients-------------
dashboard.teamMemberRecipientsQuery=select   cast(count(distinct xcuul.user_id) as int) as \"recipient\" \
from \
xt_user_profile xup \
  left join xt_campaign c on c.customer_id=xup.user_id \
  left join xt_campaign p on c.campaign_id=p.parent_campaign_id \
  left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
 left join xt_user_userlist xuul on  xuul.user_list_id=xcuul.user_list_id \
  left join xt_user_list xul on xul.user_list_id=xuul.user_list_id \
  where xul.company_id in (select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
	left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
	and p.partner_id is not null) and xup.company_id=${getCompanyIdByUserIdQuery} and p.is_launched= true
	
	
#---------------- Teammember Leads---------------------------
dashboard.teamMemberLeadsQuery=select cast(count(distinct xl.id ) as int) as \"leads\" \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
where xl.created_by_company_id in( \
select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId \
	and p.partner_id is not null) and xl.created_for_company_id=${getCompanyIdByUserIdQuery}

	
#------------Teammember Deals-------------------------------
dashboard.teamMemberDealQuery=select cast(count (distinct xd.id ) as int) as \"deals\" \
from  xt_company_profile xcp \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
where xd.created_by_company_id in( \
select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId \
and p.partner_id is not null) and xd.created_for_company_id=${getCompanyIdByUserIdQuery}

#------------- Teammember Deal Won--------------------------
dashboard.teamMemberDealWonQuery=select cast(count(distinct case when xps.is_won= true then xd.id end ) as int) as \"dealWon\" \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id in( \
select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId \
	and p.partner_id is not null) and xd.created_for_company_id=${getCompanyIdByUserIdQuery}


#----------- Team Member Deal Opportunity Amount-------------
dashboard.teamMemberDealOpportunityAmount=select sum(xd.amount) as \"Opportunity_amount\"  \
from \
xt_company_profile xcp \
left join public.xt_deal xd on (xcp.company_id = xd.created_by_company_id ) \
where xd.created_by_company_id in( \
select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
left outer join xt_partnership p on ptgm.partnership_id=p.id \
where t.team_member_id = :userId and p.partner_id is not null) and xd.created_for_company_id=${getCompanyIdByUserIdQuery}


#--------------- Team member lead to deal Conversion------------
dashboard.teamMemberleadtodealConverstion=select \
concat(round((count(distinct xd.id) *1.0/ case when count(distinct xl.id) =0 then 1 \
 else count(distinct xl.id) end )*100,2),'%')  \
as \"Leads to Deals Conversion %\" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id = xl.created_by_company_id \
left join xt_deal xd on xl.id= xd.associated_lead_id \
where xl.created_by_company_id in( \
select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
 where t.team_member_id = :userId \
and p.partner_id is not null) and  xl.created_for_company_id = ${getCompanyIdByUserIdQuery}

#-------------Team Member latest created time ---------------
dashboard.teammembercreatedDealtime=select max(created_time) as \"time\" from xt_deal \
where created_by_company_id  in (select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
	left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
	and p.partner_id is not null) and created_for_company_id =${getCompanyIdByUserIdQuery}
	
	
#---------------- Team Member Lastest Lead Created Time----------
dashboard.teammemberlatestCreatedLeadTime=select max(created_time) as \"time\" from   xt_lead \
where  created_by_company_id in (select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
	left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
	and p.partner_id is not null) and created_for_company_id =${getCompanyIdByUserIdQuery}
	
	
#------------------ Team member Contact to lead Conversion------------
dashboard.teammembercontacttoleadconvertion=select concat(round(avg("conversion") ,2),'%') as \"Contacts to Leads\" from \
(select distinct p.campaign_id , count(distinct xcuul.user_id),count(distinct xl.id), \
(round((count(distinct xl.id)*1.0/case when count(distinct xcuul.user_id) =0 then 1 \
else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign c left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id= xl.associated_user_id \
left join xt_user_profile xup on c.customer_id=xup.user_id \
where p.customer_id in ( select distinct user_id from xt_user_profile where company_id in \
(select distinct p.partner_company_id from xt_team_member t \
left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
left outer join xt_partnership p on ptgm.partnership_id=p.id \
left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
where t.team_member_id = :userId \
and p.partner_company_id is not null) )and xup.company_id= ${getCompanyIdByUserIdQuery} and p.is_launched= true \
and p.campaign_id is not null \
and p.campaign_type in('REGULAR','VIDEO','EVENT','SURVEY') \
and xcuul.user_id is not null \
group by 1 \
order by 3 desc)a



#------------------ Team Member Leads Status wise Leads -------------
dashboard.teammemberLeadsStatusWiseLeads=select distinct xps.stage_name as \"name\", cast(count(distinct xl.id) as int) as \"value\" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id=xl.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_by_company_id in (select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
	left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
	and p.partner_id is not null) and created_for_company_id =${getCompanyIdByUserIdQuery} \
group by 1 \
order by 2 desc


#------------------- Team Member Stages wise Deals-------------
dashboard.teammemberstagesWiseDeals=select distinct xps.stage_name as \"name\", cast(count(distinct xd.id) as int) as \"value\" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where  xd.created_by_company_id in (select distinct p.partner_company_id from  xt_team_member t \
 left outer join xt_team_member_group_user_mapping tgum on t.id = tgum.team_member_id \
left outer join xt_partner_team_group_mapping ptgm on tgum.id = ptgm.team_member_group_user_mapping_id \
 left outer join xt_partnership p on ptgm.partnership_id=p.id \
	left join xt_campaign xc on xc.customer_id=tgum.team_member_id \
 where t.team_member_id = :userId \
	and p.partner_id is not null) and xd.created_for_company_id =${getCompanyIdByUserIdQuery} \
group by 1 \
order by 2 desc \

#-------------LOGIN AS PARTNER--------------
#----------Vendor As Admin:-------------
#-------------Logged in Partner as OrgAdmin and Partner Recipients--------

dashboard.logInAsPartnerOrgAdminandPartnerRecipient=select cast(count(distinct a) as int) as \"recipient\" from \
(select distinct xcuul.user_id \
from xt_campaign c  \
left join xt_campaign p on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist  xcuul on xcuul.campaign_id=p.campaign_id \
left join  xt_user_profile xup on c.customer_id=xup.user_id \
where xup.company_id=:partnerCompanyId \
and p.is_launched = true  \
and p.campaign_id is not null \
and xcuul.user_id is not null \
union \
select distinct user_id \
from xt_campaign_user_userlist \
where campaign_id in (select distinct campaign_id  \
from xt_campaign \
where is_channel_campaign = false \
and is_nurture_campaign=false \
and is_launched=true \
and  customer_id in( \
select distinct user_id \
from  xt_user_profile \
where company_id=:partnerCompanyId)) \
union \
select distinct xcuul.user_id \
from xt_campaign c \
left join xt_campaign p on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on p.campaign_id=xcuul.campaign_id \
 left join xt_user_profile xup on xup.user_id=c.customer_id \
 left join xt_user_profile xup1 on xup1.user_id=p.customer_id  \
where  xup.company_id=:vendorCompanyId \
 and xup1.company_id=:partnerCompanyId \
and xcuul.user_id is not null \
)a \


 #---------------Logged in Partner as OrgAdmin and Partner Leads                      

dashboard.logInAsPartnerOrgAdminandPartnerLeads = select cast(count(distinct a) as int) as \"leads\" from \
(select distinct xl.id \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
where xl.created_for_company_id=:partnerCompanyId \
union \
select distinct xl.id \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
where xl.created_by_company_id=:partnerCompanyId \
and xl.created_for_company_id=:vendorCompanyId \
)a

###-------------Logged in Partner as OrgAdmin and Partner Deals\u2014---------

dashboard.logInAsPartnerOrgAdminandPartnerDeals =select cast(count(distinct a) as int) as \"deals\" from \
(select distinct xd.id \
 from  xt_company_profile xcp \
left join xt_deal xd on   xd.created_for_company_id =xcp.company_id \
where xd.created_for_company_id=:partnerCompanyId \
union \
select distinct xd.id \
 from  xt_company_profile xcp \
left join xt_deal xd on   xd.created_for_company_id =xcp.company_id \
where xd.created_by_company_id=:partnerCompanyId \
and xd.created_for_company_id=:vendorCompanyId \
)a

#-------------Logged in Partner as OrgAdmin and Partner WonDeals\u2014---------

dashboard.logInAsPartnerOrgAdminandPartnerDealsWon=select cast(count(distinct a) as int) as \"dealsWon\" from \
(select  \
distinct case when xps.is_won= true then xd.id end \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id=:partnerCompanyId \
union \
select  distinct case when xps.is_won= true then xd.id end \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id   \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id=:partnerCompanyId \
and xd.created_for_company_id=:vendorCompanyId )a where a is not null \

#--------------Logged in Partner as Vendor and Partner Recipients

dashboard.logInAsPartnerasVendorandPartnerRecipients =select cast(count(distinct a) as int) as \"recipient\" from \
(select distinct user_id \
from xt_campaign_user_userlist \
where campaign_id in \
(select p.campaign_id \
 from xt_campaign c \
left join xt_campaign p on c.campaign_id=p.parent_campaign_id \
where p.is_launched = true \
and  c.customer_id in \
(select distinct  user_id \
from xt_user_profile \
where company_id=:partnerCompanyId)) \
and user_id is not null \
 union \
select distinct xcuul.user_id \
from xt_campaign c \
left join xt_campaign p on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on p.campaign_id=xcuul.campaign_id \
 left join xt_user_profile xup on xup.user_id=c.customer_id \
 left join xt_user_profile xup1 on xup1.user_id=p.customer_id where \
 xup.company_id=:vendorCompanyId  \
 and xup1.company_id=:partnerCompanyId \
and xcuul.user_id is not null \
)a

#-------------Logged in Partner as Vendor and Partner Leads\u2014-----------------

dashboard.logInAsPartnerasVendorandPartnerLeads=select cast(count(distinct a) as int) as \"leads\" from \
(select distinct xl.id \
 from  xt_company_profile xcp \
left join xt_lead xl on  xl.created_for_company_id =xcp.company_id \
where xl.created_for_company_id=:partnerCompanyId \
union \
select distinct xl.id \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
where xl.created_by_company_id=:partnerCompanyId \
and xl.created_for_company_id=:vendorCompanyId)a \

#-------------Logged in Partner as Vendor and Partner Deals\u2014-----------------

dashboard.logInAsPartnerasVendorandPartnerDeals=select cast(count(distinct a) as int) as \"deals\" from \
(select distinct xd.id \
 from  xt_company_profile xcp \
left join xt_deal xd on  xd.created_for_company_id =xcp.company_id \
where xd.created_for_company_id=:partnerCompanyId \
union \
select distinct xd.id \
 from  xt_company_profile xcp \
left join xt_deal xd on   xd.created_for_company_id =xcp.company_id \
where xd.created_by_company_id=:partnerCompanyId \
and xd.created_for_company_id=:vendorCompanyId)a \

#-------------Logged in Partner as Vendor and Partner WonDeals\u2014-----------------

dashboard.logInAsPartnerasVendorandPartnerDealsWon=select cast(count(distinct a) as int) as \"dealsWon\" from \
(select  \
distinct case when xps.is_won= true then xd.id end \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id=:partnerCompanyId \
union \
select  distinct case when xps.is_won= true then xd.id end \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id=:partnerCompanyId \
and xd.created_for_company_id=:vendorCompanyId) a where a is not null \

###----------------Logged in Partner as Marketing and Partner Recipients----------------------------------

dashboard.logInAsPartnerasMarketingandPartnerRecipients =select cast(count(distinct a) as int) as \"recipients\" from \
(select distinct user_id \
from xt_campaign_user_userlist where campaign_id in \
 (select distinct campaign_id from xt_campaign \
where is_launched= true \
  and is_channel_campaign=false \
  and is_nurture_campaign=false \
and customer_id in( \
select distinct user_id \
from  xt_user_profile \
where company_id=:partnerCompanyId)) \
union \
select distinct xcuul.user_id \
from xt_campaign c left join xt_campaign p on \
c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on p.campaign_id=xcuul.campaign_id \
 left join xt_user_profile xup on xup.user_id=c.customer_id \
 left join xt_user_profile xup1 on xup1.user_id=p.customer_id \
where xup.company_id=:vendorCompanyId \
and xup1.company_id=:partnerCompanyId \
and p.is_launched=true \
and p.campaign_id is not null \
and p.is_nurture_campaign=true)a \

#-------------Logged in Partner as Marketing and Partner Leads\u2014-----------------

dashboard.logInAsPartnerasMarketingandPartnerLeads=select cast(count(distinct a) as int) as \"leads\" from \
(select distinct xl.id \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
where xl.created_for_company_id=:partnerCompanyId \
union \
select distinct xl.id \
 from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_by_company_id =xcp.company_id \
where xl.created_by_company_id=:partnerCompanyId \
and xl.created_for_company_id=:vendorCompanyId)a \

#-------------Logged in Partner as Marketing  and Partner Deals\u2014-----------------

dashboard.logInAsPartnerasMarketingandPartnerDeals=select cast(count(distinct a) as int) as \"deals\" from \
(select distinct xd.id \
 from  xt_company_profile xcp \
left join xt_deal xd on   xd.created_for_company_id =xcp.company_id \
where xd.created_for_company_id=:partnerCompanyId \
union \
select distinct xd.id \
 from  xt_company_profile xcp \
left join xt_deal xd on   xd.created_by_company_id =xcp.company_id \
where xd.created_by_company_id=:partnerCompanyId \
and xd.created_for_company_id=:vendorCompanyId)a \

#-------------Logged in Partner as Marketing and Partner WonDeals\u2014-----------------

dashboard.logInAsPartnerasMarketingandPartnerDealsWon=select cast(count(distinct a) as int) as \"dealsWon\" from \
(select distinct case when xps.is_won= true then xd.id end \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id=:partnerCompanyId \
union \
select  distinct case when xps.is_won= true then xd.id end \
from  xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id=:partnerCompanyId \
and xd.created_for_company_id=:vendorCompanyId)a \

#-------------Logged in Partner as PRM and Partner Recipients\u2014-----------------

dashboard.logInAsPartnerasPRMandPartnerRecipients=select cast(count(distinct xcuul.user_id) as int) as \"Recipients\"  \
from xt_campaign_user_userlist xcuul \
left join xt_campaign p  on xcuul.campaign_id = p.campaign_id \
left join xt_campaign c on c.campaign_id=p.parent_campaign_id \
 left join xt_user_profile xup on xup.user_id=p.customer_id \
left join xt_user_profile xup1 on xup1.user_id=c.customer_id \
 where xup.company_id=:partnerCompanyId \
and xup1.company_id=:vendorCompanyId \
and p.campaign_id is not null \
and p.is_launched=true \
and p.is_nurture_campaign=true \

#-------------Logged in Partner as PRM and Partner Leads\u2014-----------------
dashboard.logInAsPartnerasPRMandPartnerLeads=select cast(count(distinct a) as int) as \"leads\" from \
(select distinct xl.id \
from  xt_lead xl \
left join xt_pipeline_stage xps1 on xl.pipeline_stage_id =xps1.id \
where xl.created_for_company_id =:partnerCompanyId \
union \
select distinct xl.id \
from  xt_lead xl \
left join xt_pipeline_stage xps1 on xl.pipeline_stage_id =xps1.id \
where xl.created_by_company_id =:partnerCompanyId \
and xl.created_for_company_id=:vendorCompanyId)a \

#-------------Logged in Partner as PRM and Partner Deals\u2014-----------------

dashboard.logInAsPartnerasPRMandPartnerDeals=select cast(count(distinct a) as int) as \"deals\" from \
(select distinct xd.id \
from  xt_deal xd \
left join xt_pipeline_stage xps1 on xd.pipeline_stage_id =xps1.id \
where xd.created_for_company_id =:partnerCompanyId \
union \
select distinct xd.id \
from  xt_deal xd \
left join xt_pipeline_stage xps1 on xd.pipeline_stage_id =xps1.id \
where xd.created_by_company_id =:partnerCompanyId \
and xd.created_for_company_id=:vendorCompanyId)a \

##-------------Logged in Partner as PRM and Partner WonDeals\u2014-----------------

dashboard.logInAsPartnerasPRMandPartnerDealsWon=select cast(count(distinct a) as int) as \"dealsWon\" from \
(select distinct  case when xps.is_won= true then xd.id end \
from xt_company_profile xcp \
 left join xt_deal xd on xcp.company_id=xd.created_for_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id =:partnerCompanyId \
union \
select distinct case when xps.is_won= true then xd.id end \
from xt_deal xd \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id =:partnerCompanyId \
and xd.created_for_company_id =:vendorCompanyId)a where a is not null \

###-------------Logged in Partner as only Partner Recipients\u2014-----------------
#
#dashboard.logInAsPartnerasonlyPartnerRecipients=select cast(count (distinct xcuul.user_id) as text) as \"Recipients\" \
#from   xt_campaign c  \
#left join  xt_campaign p on    c.campaign_id=p.parent_campaign_id \
#left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
#left join xt_user_profile xup on xup.user_id=p.customer_id \
#left join xt_user_profile xup1 on xup1.user_id=c.customer_id \
#where xup.company_id=:partnerCompanyId \
#and xup1.company_id=:vendorCompanyId \
#and p.is_launched=true \
#and  xcuul.user_id is not null \


#-----------Pie chart and Bar Chart Queries 


#-------------For all roles including admin and login as Partner  WonLeads pie-----------------
dashboard.logInAsPartnerasWonLeadspie =select cast(count(distinct a."Won Leads") as int) as \"Won leads\" \
from  \
(select distinct case when xps.is_won = true then xl.id end as "Won Leads" \
from   xt_company_profile xcp \
left join xt_lead xl on xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_for_company_id=:partnerCompanyId \
union \
select distinct case when xps.is_won = true then xl.id end as "Won Leads" \
from   xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_by_company_id=:partnerCompanyId \
and xl.created_for_company_id = :vendorCompanyId)a \

#-------------For all roles including admin and login as Partner  Lost Leads pie-----------------
dashboard.logInAsPartnerasLostLeadspie =select cast(count(distinct a."Lost Leads") as int) as \"Lost leads\" \
from  \
(select distinct case when xps.is_lost= true then xl.id end as "Lost Leads" \
from   xt_company_profile xcp \
left join xt_lead xl on xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_for_company_id=:partnerCompanyId \
union \
select distinct  case when xps.is_lost= true then xl.id end  as "Lost Leads" \
from   xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_by_company_id=:partnerCompanyId \
and xl.created_for_company_id = :vendorCompanyId)a \

#-------------For all roles including admin and login as Partner  Converted Leads pie-----------------
dashboard.logInAsPartnerasConvertedLeadspie =select cast(count(distinct a."Converted Leads" )as int) as \"Converted leads\"  \
from  \
(select distinct case when xd.associated_lead_id = xl.id  then xl.id end as "Converted Leads" \
from   xt_company_profile xcp \
left join xt_lead xl on xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on xd.created_for_company_id=xcp.company_id  \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_for_company_id=:partnerCompanyId \
union \
select distinct case when xd.associated_lead_id = xl.id  then xl.id end as "Converted Leads" \
from   xt_company_profile xcp \
left join xt_lead xl on   xl.created_for_company_id =xcp.company_id \
left join xt_deal xd on  xd.created_for_company_id=xcp.company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_by_company_id=:partnerCompanyId \
and xl.created_for_company_id = :vendorCompanyId)a \

#-------------For all roles including admin and login as Partner  WonDeals pie-----------------

dashboard.logInAsPartnerasDealsWonpie=select cast(count(distinct a."Won Deals") as int) as \"Won deals\" from \
(select distinct case when xps.is_won = true then xd.id end as "Won Deals" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id =:partnerCompanyId \
union \
select distinct case when xps.is_won = true then xd.id end as "Won Deals" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id =:partnerCompanyId \
and xd.created_for_company_id = :vendorCompanyId)a

#-------------For all roles including admin and login as Partner  LostDeals pie-----------------

dashboard.logInAsPartnerasDealsLostpie=select cast(count(distinct a."Lost Deals") as int) as \"Lost deals\"  \
from \
(select distinct  case when xps.is_lost= true then xd.id end  as "Lost Deals" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id =:partnerCompanyId \
union \
select distinct case when xps.is_lost= true then xd.id end  as "Lost Deals" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id =:partnerCompanyId \
and xd.created_for_company_id = :vendorCompanyId)a \

##-------------For all roles including admin and login as Partner Stages wise Leads-----------------

dashboard.logInAsPartnerStageswiseLeads=select distinct a."Stage Name" as \"name\", cast(count(distinct a."Leads") as int) as  \"value\" \
from \
(select distinct xps.stage_name as "Stage Name",  xl.id as "Leads" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id=xl.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_for_company_id =:partnerCompanyId \
union \
select distinct xps.stage_name as "Stage Name", xl.id as "Leads" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id=xl.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xl.pipeline_stage_id \
where xl.created_by_company_id =:partnerCompanyId \
and xl.created_for_company_id  = :vendorCompanyId)a \
group by 1 \
order by 2 desc \

##-------------For all roles including admin and login as Partner Stages wise Deals-----------------

dashboard.logInAsPartnerStageswiseDeals=select distinct a."Stage Name" as \"name\", cast(count(distinct a."Deals") as int) as \"value\" from \
(select distinct xps.stage_name as "Stage Name", xd.id as "Deals" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_for_company_id =:partnerCompanyId \
union \
select distinct xps.stage_name as "Stage Name",  xd.id as "Deals" \
from \
xt_company_profile xcp \
left join xt_deal xd on xcp.company_id=xd.created_by_company_id \
left join xt_pipeline_stage xps on xps.id =xd.pipeline_stage_id \
where xd.created_by_company_id =:partnerCompanyId \
and xd.created_for_company_id = :vendorCompanyId)a \
group by 1 \
order by 2 desc

##-------------For all roles including admin and login as Partner  Lead Created Time-----------------
dashboard.logInAsPartnerLeadCreatedTime=select max(a.created_time)  as \"Lead Created Time\" \
from  \
(select created_time from   xt_lead \
where created_for_company_id=:partnerCompanyId \
union \
select created_time from   xt_lead \
where created_by_company_id= :partnerCompanyId \
and created_for_company_id = :vendorCompanyId)a \

##-------------For all roles including admin and login as Partner  Deal Created Time-----------------

dashboard.logInAsPartnerDealCreatedTime=select max(a.created_time)  as \"deal Created Time\" \
from \
(select created_time from xt_deal \
where created_for_company_id=:partnerCompanyId \
union \
select created_time from   xt_deal \
where created_by_company_id= :partnerCompanyId \
and created_for_company_id = :vendorCompanyId)a \

####------------------Lead to Deal Conversion

###----------- For all roles Admin and when logged in as Partner Leads to deal Conversion\u2014--

dashboard.logInAsPartnerLeadstodealConversion=select concat(round(avg(a."Leads to Deals Conversion %")* 100,2),'%')  \"Leads to Deals Conversion %\" \
 from  \
(select count(distinct xd.id) *1.0/ case when count(distinct xl.id) =0 then 1 \
else count(distinct xl.id) end as "Leads to Deals Conversion %" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id = xl.created_by_company_id \
left join xt_deal xd on xl.id= xd.associated_lead_id \
where xl.created_for_company_id = :partnerCompanyId \
union \
select count(distinct xd.id) *1.0/ case when count(distinct xl.id) =0 then 1 \
 else count(distinct xl.id) end  as "Leads to Deals Conversion %" \
from \
xt_company_profile xcp \
left join xt_lead xl on xcp.company_id = xl.created_by_company_id \
left join xt_deal xd on xl.id= xd.associated_lead_id \
where xl.created_by_company_id = :partnerCompanyId \
and xl.created_for_company_id = :vendorCompanyId)a \

#-------------------------Contact to Lead Conversion 
####----------------------logged in as OrgAdmin and Partner (Contacts to leads Conversion)--------------

dashboard.logInAsPartnerOrgAdminandPartnerContactstoleadsConversion=select concat(round(avg("conversion")*100 ,2) , '%')  as  \"Contacts to Leads \" from \
(select count(distinct xl.id) *1.0/  \
case when count(distinct xcuul.user_id) =0 then 1 \
else count(distinct xcuul.user_id) end as "conversion" \
from xt_campaign c  left join xt_campaign p  \
on c.campaign_id=p.parent_campaign_id  \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id  \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id= xl.associated_user_id  \
left join  xt_user_profile xup on c.customer_id=xup.user_id  \
where xup.company_id= :partnerCompanyId \
and p.campaign_id is not null and p.is_launched = true \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
union  \
select count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1  \
 else count(distinct xcuul.user_id) end as "Conversion" \
from xt_campaign_user_userlist xcuul  \
left join  xt_campaign c on xcuul.campaign_id=c.campaign_id  \
 left join xt_lead xl on xcuul.campaign_id=xl.campaign_id \
 and xcuul.user_id= xl.associated_user_id  \
  where c.customer_id in( select distinct user_id  \
from  xt_user_profile  where company_id=:partnerCompanyId ) \
and c.campaign_id is not null and c.is_launched = true  \
and c.is_channel_campaign =false and c.is_nurture_campaign=false  \
and c.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT')  \
and xcuul.user_id is not null \
 union \
select count(distinct xl.id) *1.0/ \
  case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end  "conversion" \
from xt_campaign c left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id=xl.associated_user_id \
 left join xt_user_profile xup on xup.user_id=p.customer_id \
     left join xt_user_profile xup1 on xup1.user_id=c.customer_id \
where xup.company_id=:partnerCompanyId \
and xup1.company_id=:vendorCompanyId \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
)a \

###------------Logged in as Vendor and Partner (Contact to Lead Conversion)--------------

dashboard.logInAsPartnerVendorandPartnerContactstoleadsConversion=select concat(round(avg("conversion") *100,2) , '%') as  \"Contacts to Leads \" from \
(select count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end  "conversion" \
from xt_campaign c  left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
 left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
 left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id= xl.associated_user_id \
 left join  xt_user_profile xup on c.customer_id=xup.user_id \
where xup.company_id=:partnerCompanyId \
and p.is_launched=true \
and p.campaign_id is not null \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
union \
select count(distinct xl.id) *1.0/ \
 case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end  "conversion" \
from xt_campaign c left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id=xl.associated_user_id \
 left join xt_user_profile xup on xup.user_id=p.customer_id \
   left join xt_user_profile xup1 on xup1.user_id=c.customer_id \
where xup.company_id=:partnerCompanyId \
and xup1.company_id=:vendorCompanyId \
and  p.is_launched=true \
 and p.campaign_id is not null \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null  \
)a \

####----------------------Logged in as Marketing and Partner (Contacts to Leads Conversion)-----------

dashboard.logInAsPartnerMarketingandPartnerContactstoleadsConversion=select concat(round(avg("conversion")*100 ,2) , '%') as  \"Contacts to Leads \" from \
(select count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end "conversion" \
 from xt_campaign_user_userlist xcuul \
left join  xt_campaign c on xcuul.campaign_id=c.campaign_id \
 left join xt_lead xl on xcuul.campaign_id=xl.campaign_id  and xcuul.user_id= xl.associated_user_id \
  where is_channel_campaign=false \
 and is_nurture_campaign=false \
and c.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
and c.customer_id in( \
select distinct user_id \
from  xt_user_profile \
where company_id=:partnerCompanyId) \
union \
select count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
else count(distinct xcuul.user_id) end  "conversion" \
from \
xt_campaign c left join  xt_campaign p on \
c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xl.campaign_id=xcuul.campaign_id and xcuul.user_id=xl.associated_user_id \
left join xt_user_profile xup on xup.user_id=p.customer_id \
left join xt_user_profile xup1 on xup1.user_id=c.customer_id \
where xup.company_id=:partnerCompanyId \
and xup1.company_id=:vendorCompanyId \
and p.is_launched=true \
and p.campaign_id is not null \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null)a

###-------------Logged in as PRM and Partner/ only Partner (Contact to Lead Conversion)--------------

dashboard.logInAsPartnerPRMandPartnerContactstoleadsConversion=select concat(round(avg("conversion")*100 ,2) , '%') as \"Contacts to Leads \"  from \
(select count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end  "conversion" \
from xt_campaign c left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id=xl.associated_user_id \
 left join xt_user_profile xup on xup.user_id=p.customer_id \
     left join xt_user_profile xup1 on xup1.user_id=c.customer_id \
where xup.company_id=:partnerCompanyId \
and xup1.company_id=:vendorCompanyId \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null)a \

###-------------For all roles including admin and login as Partner Opportunity Amount -----------------

dashboard.logInAsPartnerOpportunityAmount=select sum(a."Opportunity_amount" ) as \"Opportunity_amount\"  \
from \
(select xd.amount as "Opportunity_amount"   \
from \
xt_company_profile xcp \
left join public.xt_deal xd on (xcp.company_id = xd.created_by_company_id ) \
where xd.created_for_company_id = :partnerCompanyId \
union all \
select  xd.amount as "Opportunity_amount" \
from \
xt_company_profile xcp \
left join public.xt_deal xd on (xcp.company_id = xd.created_by_company_id ) \
where xd.created_by_company_id = :partnerCompanyId \
and xd.created_for_company_id= :vendorCompanyId)a

###---------------PRM as Admin

######-------------Logged in as OrgAdmin and  Partner (Contact to Lead Conversion) --------------

dashboard.logInAsPartnerOrgAdminandPartnerPRMasAdminContacttoLead=select concat(round(avg("conversion")*100 ,2) , '%') as \"Contacts to Leads\" from \
(select count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
else count(distinct xcuul.user_id) end as "conversion" \
from xt_campaign c  left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id= xl.associated_user_id \
left join  xt_user_profile xup on c.customer_id=xup.user_id \
where xup.company_id= ${getCompanyIdByUserIdQuery} \
and p.campaign_id is not null and p.is_launched = true \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
union \
select count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end as "Conversion" \
from xt_campaign_user_userlist xcuul \
left join  xt_campaign c on xcuul.campaign_id=c.campaign_id \
left join xt_lead xl on xcuul.campaign_id=xl.campaign_id \
and xcuul.user_id= xl.associated_user_id \
where c.customer_id in( select distinct user_id \
from  xt_user_profile  where company_id=${getCompanyIdByUserIdQuery} ) \
and c.campaign_id is not null and c.is_launched = true \
and c.is_channel_campaign =false and c.is_nurture_campaign=false \
and c.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT')  \
and xcuul.user_id is not null)a \

#######-------------Logged in as Vendor and  Partner (Contact to Lead Conversion) -------------

dashboard.logInAsPartnerVendorandPartnerPRMasAdminContacttoLead=select concat(round(avg("conversion") ,2) , '%') \"Contacts to Leads\" from \
(select distinct p.campaign_id ,count(distinct xcuul.user_id), count(distinct xl.id), \
(round((count(distinct xl.id) *1.0/  case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end )*100,2)) "conversion" \
from xt_campaign c  left join xt_campaign p \
on c.campaign_id=p.parent_campaign_id \
 left join xt_campaign_user_userlist xcuul on xcuul.campaign_id=p.campaign_id \
 left join xt_lead xl on xcuul.campaign_id=xl.campaign_id and xcuul.user_id= xl.associated_user_id  \
 left join  xt_user_profile xup on c.customer_id=xup.user_id \
where xup.company_id=${getCompanyIdByUserIdQuery} \
and p.is_launched=true \
and p.campaign_id is not null \
and p.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
group by 1)a \

####-------------Logged in as Marketing  and  Partner (Contact to Lead Conversion) --------------

dashboard.logInAsPartnerMarketingandPartnerPRMasAdminContacttoLead=select concat(round(avg("conversion")*100 ,2) , '%') \"Contacts to Leads\" from \
(select count(distinct xl.id) *1.0/ \
case when count(distinct xcuul.user_id) =0 then 1 \
 else count(distinct xcuul.user_id) end  "conversion" \
from xt_campaign_user_userlist xcuul \
left join  xt_campaign c on xcuul.campaign_id=c.campaign_id \
 left join xt_lead xl on xcuul.campaign_id=xl.campaign_id  and xcuul.user_id= xl.associated_user_id \
  where is_channel_campaign=false \
 and is_nurture_campaign=false \
and c.campaign_type in('REGULAR','VIDEO','SURVEY','EVENT') \
and xcuul.user_id is not null \
and c.customer_id in( \
select distinct user_id \
from  xt_user_profile \
where company_id=${getCompanyIdByUserIdQuery}) \
)a


#XNFR-459#
id.parameter = \"id\"
title.parameter = \"title\"
slug.parameter = \"slug\"
date.parameter = \"date\"
type.parameter = \"type\"
damPartnerId.parameter = \"damPartnerId\"
instantNavigationLinks.partner.dam.query = select distinct d.id as ${id.parameter}, d.asset_name as ${title.parameter},null as ${slug.parameter},xdpm.created_time as ${date.parameter},cast('Asset' as text) as ${type.parameter}, xdp.id as ${damPartnerId.parameter}  \
from xt_dam_partner xdp left join xt_dam d on d.id=xdp.dam_id left join xt_dam_partner_mapping xdpm on xdpm.dam_partner_id=xdp.id left join xt_partnership xp on xp.id=xdp.partnership_id and d.company_id =xp.vendor_company_id \
left join xt_module_access ma on ma.company_id =xp.vendor_company_id left join xt_user_profile xup1 on xup1.user_id=xdpm.partner_id where xp.vendor_company_id=:vendorCompanyId and xdp.partnership_id=:partnershipId and xup1.user_id=:loggedInUserId and ma.dam= true and d.is_added_to_quick_links ${searchQueryString} \
UNION \
select  distinct on (d.id)d.id as ${id.parameter}, d.asset_name as ${title.parameter},null as ${slug.parameter},dpgm.created_time as ${date.parameter},cast('Asset' as text) as ${type.parameter},dp.id as ${damPartnerId.parameter} \
from xt_dam_partner dp join xt_dam d on dp.dam_id = d.id join xt_partnership p on p.id = dp.partnership_id join xt_dam_partner_group_mapping dpgm on dp.id = dpgm.dam_partner_id \
left join xt_dam_analytics xda on xda.dam_partner_fk_id =dp.id left join xt_user_profile xup1 on xup1.user_id=dpgm.user_id left join xt_module_access ma on ma.company_id =p.vendor_company_id WHERE p.vendor_company_id = :vendorCompanyId \
and dp.partnership_id=:partnershipId and ma.dam =true and d.is_added_to_quick_links ${searchQueryString} \


instantNavigationLinks.partner.track.query = select distinct xlt.id as ${id.parameter}, xlt.title as ${title.parameter}, xlt.slug as ${slug.parameter}, xltv.published_on as ${date.parameter},cast('Track' as text) as ${type.parameter},0 as ${damPartnerId.parameter} from xt_learning_track_visibility xltv \
left join xt_learning_track xlt on xltv.learning_track_id=xlt.id left join xt_module_access ma on ma.company_id =xlt.company_id left join xt_user_profile xup1 on xup1.user_id=xltv.user_id where xlt.company_id= :vendorCompanyId \
and xup1.user_id=:loggedInUserId  and xlt.type = 'TRACK' and xlt.is_published = true and ma.lms =true and xlt.is_added_to_quick_links ${searchQueryString} \

instantNavigationLinks.partner.playbook.query = select distinct xlt.id as ${id.parameter}, xlt.title as ${title.parameter}, xlt.slug as ${slug.parameter}, xltv.published_on as ${date.parameter},cast('Play Book' as text) as ${type.parameter},0 as ${damPartnerId.parameter} \
from xt_learning_track_visibility xltv left join xt_learning_track xlt on xltv.learning_track_id=xlt.id left join xt_module_access ma on ma.company_id =xlt.company_id \
left join xt_user_profile xup1 on xup1.user_id=xltv.user_id where xlt.company_id= :vendorCompanyId and xup1.user_id=:loggedInUserId and xltv.partnership_id = :partnershipId \
and xlt.type = 'PLAYBOOK' and xlt.is_published = true and ma.play_books =true and xlt.is_added_to_quick_links ${searchQueryString} \


instantNavigationLinks.vendor.dam.query = select distinct d.id as  ${id.parameter}, d.asset_name as ${title.parameter}, d.created_time as ${date.parameter}, cast('Asset' as text) as ${type.parameter}, \
case when count(dp.id)>0 then true else false end as \"published"\, d.asset_type as \"assetType\", d.is_bee_template as \"beeTemplate\", video_id as \"videoId\", d.asset_name as  ${slug.parameter}  \
from xt_dam d left join xt_dam_partner dp on dp.dam_id = d.id  where d.company_id=:companyId and d.is_added_to_quick_links ${searchQueryString} group by d.id \

instantNavigationLinks.vendor.track.query = select id as ${id.parameter} , title as ${title.parameter}, created_time as ${date.parameter}, cast('Track' as text) as ${type.parameter}, is_published as \"published\", cast('Track' as text) as \"assetType\", is_added_to_quick_links as \"beeTemplate\", id as \"videoId\", slug as ${slug.parameter} \
from xt_learning_track where company_id=:companyId and type='TRACK' and is_added_to_quick_links ${searchQueryString} \

instantNavigationLinks.vendor.playbook.query = select id as ${id.parameter} , title ${title.parameter} , created_time as ${date.parameter} , cast('Play Book' as text) as ${type.parameter}, is_published as \"published\", cast('Track' as text) as \"assetType\", is_added_to_quick_links as \"beeTemplate\", id as \"videoId\", slug as ${slug.parameter} \
from xt_learning_track where company_id=:companyId and type='PLAYBOOK' and is_added_to_quick_links ${searchQueryString} \


instantNavigationLinks.vendor.order.query = order by 3 desc 

instantNavigationLinks.partner.order.query = order by 4 desc 

#XNFR-758#
universalsearch.dam.query = select distinct  d.id as \"id\", d.asset_name as \"name\", cast(d.asset_type as text) as \"slug\", case when d.video_id is null then string_agg(DISTINCT t.tag_name, ',') \
  else string_agg(DISTINCT vt.video_tags, ',') end AS \"tag\", \
cast(null as text) as \"stage\",concat(xup.firstname, ' ' ,xup.lastname) as \"createdBy\", cast(null as text) as \"from\",cast('Asset' as text) as \"type\", \
cast(null as int) as \"damPartnerId\", d.is_bee_template as \"beeTemplate\", \
d.video_id as \"videoId\" , cast(cat.name as text) as \"folder\", \
case when d.parent_id is not null then true \
else false end as \"expand\", cast(null as text) as \"referenceId\", cast(null as text) as\"campaignName\" ,cast(null as text) \"companyName\",cast(null as text) \"addedFor\", cast(null as text) as "\activeIntegrationId\" \
,cast('Manage' as text)  as \"navigate\", cast(null as int) \"createdByCompanyId\" \
from xt_dam d left join xt_dam_partner dp on dp.dam_id = d.id \
left join xt_dam_partner_mapping xdpm on xdpm.dam_partner_id=dp.id \
left join xt_user_profile xup1 on xup1.user_id=xdpm.partner_id \
left join  xt_user_profile xup on xup.user_id=d.created_by \
left join xt_dam_tag xdt on xdt.dam_id=d.id left join xt_tag t on xdt.tag_id= t.id \
LEFT JOIN  xt_video_files v on v.id =d.video_id LEFT JOIN xt_video_tags vt on v.id = vt.video_id \
left join xt_category_module cm on cm.dam_id = d.id \
left join xt_company_profile xcp on xcp.company_id=xup.company_id \
left join xt_category cat on cat.id = cm.category_id \
where  ${partnerCompanyIdQueryString} ${searchQueryString} \

universalsearch.track.query =select distinct on(xlt.id)xlt.id as \"id\" , title as \"name\" , cast(slug as text) as \"slug\", \
STRING_AGG(distinct t.tag_name, ', ') as \"tag\", cast(null as text) as \"stage\", \
concat(xup.firstname ,' ',xup.lastname, ' ' ,xup.middle_name)  as \"createdBy\", \
 concat(xup1.firstname, ' ' ,xup1.lastname)   as \"from\", \
cast('Track' as text) as \"type\", cast(null as int) as \"damPartnerId\", \
false as \"beeTemplate\", cast(null as int) as \"videoId\", cast(cat.name as text) as \"folder\", false as \"expand\", cast(null as text) as \"referenceId\", \
cast(null as text) as\"campaignName\" ,cast(null as text) \"companyName\",cast(null as text) \"addedFor\", cast(null as text) as "\activeIntegrationId\" \
${navigateQueryString}, xup.company_id as \"createdByCompanyId\" \
from xt_learning_track xlt \
left join xt_learning_track_visibility xltv  on xltv.learning_track_id=xlt.id \
left join xt_user_profile xup1 on xup1.user_id=xltv.user_id \
LEFT  JOIN xt_learning_track_tag lt ON xlt.id = lt.learning_track_id \
LEFT  JOIN xt_tag t ON lt.tag_id = t.id \
left join xt_user_profile xup on xup.user_id= xlt.created_by \
left JOIN xt_category_module cm ON xlt.id = cm.learning_track_id \
left join xt_category cat on cat.id = cm.category_id \
where type='TRACK' ${partnerCompanyIdQueryString} ${searchQueryString} \

universalsearch.playbook.query = select distinct on(xlt.id)xlt.id as \"id\" , title as \"name\" , cast(slug as text) as \"slug\", \
STRING_AGG(distinct t.tag_name, ', ') as \"tag\", cast(null as text) as \"stage\", \
concat(xup.firstname ,' ',xup.lastname, ' ' ,xup.middle_name)  as \"createdBy\", \
 concat(xup1.firstname, ' ' ,xup1.lastname)   as \"from\", \
cast('Play Book' as text) as \"type\", cast(null as int) as \"damPartnerId\", \
false as \"beeTemplate\", cast(null as int) as \"videoId\", cast(cat.name as text) as \"folder\", false as \"expand\", cast(null as text) as \"referenceId\", \
cast(null as text) as\"campaignName\" ,cast(null as text) \"companyName\",cast(null as text) \"addedFor\", cast(null as text) as "\activeIntegrationId\" \
${navigateQueryString},  xup.company_id as \"createdByCompanyId\" \
from xt_learning_track xlt \
left join xt_learning_track_visibility xltv  on xltv.learning_track_id=xlt.id \
left join xt_user_profile xup1 on xup1.user_id=xltv.user_id \
LEFT  JOIN xt_learning_track_tag lt ON xlt.id = lt.learning_track_id \
LEFT  JOIN xt_tag t ON lt.tag_id = t.id \
left join xt_user_profile xup on xup.user_id= xlt.created_by \
left JOIN xt_category_module cm ON xlt.id = cm.learning_track_id \
left join xt_category cat on cat.id = cm.category_id \
where type='PLAYBOOK' ${partnerCompanyIdQueryString} ${searchQueryString} \ 

universalsearch.leads.query = select distinct on(xl.id)xl.id as \"id\", concat(first_name,' ',last_name) as \"name\", \
cast(null as text) as \"slug\", cast(null as text) as \"tag\",xps.stage_name as \"stage\", xl.email as \"createdBy\" ,xup.email_id  as \"from\", \
cast('Lead' as text) as \"type\",cast (null as int) as \"damPartnerId\",  false as \"beeTemplate\", cast(null as int) as \"videoId\" , \
cast(null as text) as \"folder\", false as \"expand\",  cast(crm_reference_id as text) as \"referenceId\", xc.campaign_name as\"campaignName\" ,xl.company \"companyName\",xcp.company_name \"addedFor\",  \
cast(CASE  WHEN xi.type = 'salesforce' THEN cast(xl.sf_lead_id AS text) \
WHEN xi.type = 'hubspot' THEN CAST(xl.hubspot_lead_id AS text) \
        WHEN xi.type = 'microsoft' THEN cast(xl.microsoft_dynamics_lead_id as text) \
        WHEN xi.type = 'pipedrive' THEN cast(xl.pipedrive_lead_id as text) \
        WHEN xi.type = 'connectwise' THEN cast(xl.connectwise_lead_id as text) \
        WHEN xi.type = 'halopsa' THEN cast(xl.halopsa_lead_id as text) \
        WHEN xi.type = 'zoho' THEN cast(xl.zoho_lead_id as text) \
        ELSE NULL \
    END as text) AS "\activeIntegrationId\" \
   ${navigateQueryString}, cast(null as int) \"createdByCompanyId\" \
from xt_lead xl \
left join xt_user_profile xup  on xup.user_id= xl.created_by \
left join xt_pipeline_stage xps on xl.pipeline_stage_id=xps.id \
left join xt_company_profile xcp on xcp.company_id= xl.created_for_company_id \
left join xt_company_profile xcp1 on xcp1.company_id = xl.created_by_company_id \
left join xt_campaign xc on xc.campaign_id= xl.campaign_id \
left join xt_integration xi on xcp.company_id = xi.company_id \
where   ${partnerCompanyIdQueryString} ${searchQueryString} \

universalsearch.deals.query = select distinct on(xd.id)xd.id as \"id\", title as \"name\", cast(deal_type as text) as \"slug\",cast(null as text) as \"tag\" , \
xps.stage_name as \"stage\",xup.email_id as \"createdBy\", xup.email_id as \"from\", \
cast('Deal' as text) as \"type\",  cast(null as int)  as \"damPartnerId\", \
false as \"beeTemplate\", cast(null as int) as \"videoId\" ,cast(null as text) as \"folder\", false as \"expand\", cast(crm_reference_id as text) as \"referenceId\",  \
xc.campaign_name as\"campaignName\" ,cast(null as text) \"companyName\",xcp.company_name \"addedFor\", \
cast(CASE  WHEN xi.type = 'salesforce' THEN cast(xd.sf_deal_id AS text) \
WHEN xi.type = 'hubspot' THEN CAST(xd.hubspot_deal_id AS text) \
        WHEN xi.type = 'microsoft' THEN cast(xd.microsoft_dynamics_deal_id as text) \
        WHEN xi.type = 'pipedrive' THEN cast(xd.pipedrive_deal_id as text) \
        WHEN xi.type = 'connectwise' THEN cast(xd.connectwise_deal_id as text) \
        WHEN xi.type = 'halopsa' THEN cast(xd.halopsa_deal_id as text) \
        WHEN xi.type = 'zoho' THEN cast(xd.zoho_deal_id as text) \
        ELSE NULL \
    END as text) AS "\activeIntegrationId\" \
    ${navigateQueryString} , cast(null as int) \"createdByCompanyId\" \
    from xt_deal xd \
left join xt_user_profile xup  on xup.user_id= xd.created_by \
left join xt_pipeline_stage xps on xd.pipeline_stage_id=xps.id \
left join xt_company_profile xcp on xcp.company_id= xd.created_for_company_id \
left join xt_company_profile xcp1 on xcp1.company_id= xd.created_by_company_id \
left join xt_campaign xc on xc.campaign_id= xd.campaign_id \
left join xt_integration xi on xcp.company_id = xi.company_id \
where  ${partnerCompanyIdQueryString} ${searchQueryString} \


universalsearch.partner.vanity.query = select distinct on(d.id)d.id as \"id\", d.asset_name as \"name\", cast(d.asset_type as text) as \"slug\", \
case when d.video_id is null then string_agg(DISTINCT t.tag_name, ',') \
  else string_agg(DISTINCT vt.video_tags, ',') end AS \"tag\", cast(null as text) as \"stage\", \
concat(xup.firstname, ' ', xup.lastname) as \"createdBy\" , \
cast(xcp.company_name as text) as \"from\", \
cast('Asset' as text) as \"type\", \
xdp.id as \"damPartnerId\", false as \"beeTemplate\", cast(null as int) as \"videoId\" ,cast(cat.name as text) as \"folder\", \
case when d.parent_id is not null then true \
else false end as \"expand\",  cast(null as text) as \"referenceId\", cast(null as text) as\"campaignName\" ,cast(null as text) \"companyName\",cast(null as text) \"addedFor\", cast(null as text) as "\activeIntegrationId\" \
,cast('Shared' as text)  as \"navigate\", cast(null as int) \"createdByCompanyId\"  \
from xt_dam_partner xdp \
left join xt_dam d on d.id=xdp.dam_id left join xt_dam_partner_mapping xdpm \
on xdpm.dam_partner_id=xdp.id \
left join xt_partnership xp on xp.id=xdp.partnership_id and d.company_id =xp.vendor_company_id \
left join xt_module_access ma on ma.company_id =xp.vendor_company_id \
left join xt_user_profile xup on xup.user_id=xdp.published_by \
left join xt_company_profile xcp on xcp.company_id= xup.company_id \
left join xt_user_profile xup1 on xup1.user_id=xdpm.partner_id \
left join xt_dam_tag xdt on xdt.dam_id=d.id \
left join xt_tag t on xdt.tag_id= t.id \
LEFT JOIN  xt_video_files v on v.id =d.video_id LEFT JOIN xt_video_tags vt on v.id = vt.video_id \
left join xt_category_module cm on cm.dam_id = d.id \
left join xt_category cat on cat.id = cm.category_id \
where ${whereCondionPartnerUserIdQueryString} \
and ma.dam = true ${searchQueryString} \
UNION \
select distinct on(d.id)d.id as \"id\", d.asset_name as \"name\", d.asset_type as \"slug\", \
case when d.video_id is null then string_agg(DISTINCT t.tag_name, ',') \
  else string_agg(DISTINCT vt.video_tags, ',') end AS \"tag\", cast(null as text) as \"stage\", \
concat(xup.firstname, ' ', xup.lastname) as \"createdBy\" , \
cast(xcp.company_name as text) as \"from\", \
cast('Asset' as text) as \"type\", \
dp.id as \"damPartnerId\", false as \"beeTemplate\", cast(null as int) as \"videoId\" ,cast(cat.name as text) as \"folder\", \
case when d.parent_id is not null then true \
else false end as \"expand\",  cast(null as text) as \"referenceId\", cast(null as text) as\"campaignName\" ,cast(null as text) \"companyName\",cast(null as text) \"addedFor\", cast(null as text) as "\activeIntegrationId\" \
,cast('Shared' as text)  as \"navigate\", cast(null as int) \"createdByCompanyId\" \
from xt_dam_partner dp \
join xt_dam d on dp.dam_id = d.id join xt_partnership p on p.id = dp.partnership_id \
left join xt_user_profile xup on xup.user_id=dp.published_by \
left join xt_company_profile xcp on xcp.company_id=xup.company_id \
left join xt_dam_partner_group_mapping dpgm on dp.id = dpgm.dam_partner_id \
left join xt_dam_analytics xda on xda.dam_partner_fk_id =dp.id \
left join xt_user_profile xup1 on xup1.user_id=dpgm.user_id \
left join xt_module_access ma on ma.company_id =p.vendor_company_id \
left join xt_dam_tag xdt on xdt.dam_id=d.id \
left join xt_tag t on xdt.tag_id= t.id \
LEFT JOIN  xt_video_files v on v.id =d.video_id LEFT JOIN xt_video_tags vt on v.id = vt.video_id \
left join xt_category_module cm on cm.dam_id = d.id \
left join xt_category cat on cat.id = cm.category_id \
where ${partnerCompanyIdQueryString} \
and ma.dam = true ${searchQueryString} \

universalsearch.onboardpartners.query = select distinct up.user_id as \"id\", cast(up.email_id as text) as \"name\", \
concat(uul.firstname ,' ', uul.lastname) as \"slug\" ,  CASE \
 WHEN uul.contact_company IS NOT null AND xcp.company_name IS NOT null \
 and xcp.company_name_status = 'active' \
 then CONCAT(xcp.company_name, ', aka-', uul.contact_company)ELSE uul.contact_company END AS \"tag\", \
cast(up.status as text) as \"stage\",case when "company_name_status" is not null then cast(xcp."company_name_status" as text) \
else cast('inactive' as text) end \
as \"createdBy\", \
cast(null as text) as \"from\",cast('Partners' as text) as \"type\",cast(null as int) as \"damPartnerId\", \
false as \"beeTemplate\",cast(null as int) as \"videoId\",cast(null as text) as \"folder\", false as \"expand\", \
cast(null as text) as \"referenceId\",cast(null as text) as \"campaignName\",cast(null as text) as \"companyName\",cast(null as text) as \"addedFor\",cast(null as text) as \"activeIntegrationId\", \
cast(null as text) as \"navigate\", cast(null as int) as \"createdByCompanyId\" \
FROM xt_user_list u  JOIN xt_user_userlist uul ON u.user_list_id = uul.user_list_id \
 left  JOIN xt_user_profile up ON uul.user_id = up.user_id \
 left  join xt_company_profile xcp on xcp.company_id=up.company_id \
 where u.module_name ='PARTNERS' \
 and  u.company_id= ${loggedUserCompanyID} and u.user_list_id = ${userListId} ${teamMemberQueryString} ${searchQueryString} \